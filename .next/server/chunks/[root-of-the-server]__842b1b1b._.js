module.exports=[193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},843793,e=>{"use strict";var t=e.i(660724);let r=global.prisma||new t.PrismaClient;e.s(["db",0,r])},698043,e=>{"use strict";let t=e.i(843793).db;e.s(["default",0,t,"prisma",0,t])},145706,(e,t,r)=>{t.exports=e.x("querystring",()=>require("querystring"))},575096,e=>{e.v({name:"openid-client",version:"5.7.1",description:"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs",keywords:["auth","authentication","basic","certified","client","connect","dynamic","electron","hybrid","identity","implicit","oauth","oauth2","oidc","openid","passport","relying party","strategy"],homepage:"https://github.com/panva/openid-client",repository:"panva/openid-client",funding:{url:"https://github.com/sponsors/panva"},license:"MIT",author:"Filip Skokan <panva.ip@gmail.com>",exports:{types:"./types/index.d.ts",import:"./lib/index.mjs",require:"./lib/index.js"},main:"./lib/index.js",types:"./types/index.d.ts",files:["lib","types/index.d.ts"],scripts:{format:"npx prettier --loglevel silent --write ./lib ./test ./certification ./types",test:"mocha test/**/*.test.js"},dependencies:{jose:"^4.15.9","lru-cache":"^6.0.0","object-hash":"^2.2.0","oidc-token-hash":"^5.0.3"},devDependencies:{"@types/node":"^16.18.106","@types/passport":"^1.0.16",base64url:"^3.0.1",chai:"^4.5.0",mocha:"^10.7.3",nock:"^13.5.5",prettier:"^2.8.8","readable-mock-req":"^0.2.2",sinon:"^9.2.4",timekeeper:"^2.3.1"},"standard-version":{scripts:{postchangelog:"sed -i '' -e 's/### \\[/## [/g' CHANGELOG.md"},types:[{type:"feat",section:"Features"},{type:"fix",section:"Fixes"},{type:"chore",hidden:!0},{type:"docs",hidden:!0},{type:"style",hidden:!0},{type:"refactor",section:"Refactor",hidden:!1},{type:"perf",section:"Performance",hidden:!1},{type:"test",hidden:!0}]}})},500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},449719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},224361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},427699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},59639,(e,t,r)=>{t.exports=e.x("node:process",()=>require("node:process"))},660526,(e,t,r)=>{t.exports=e.x("node:os",()=>require("node:os"))},509656,(e,t,r)=>{t.exports=e.x("node:tty",()=>require("node:tty"))},902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},874533,(e,t,r)=>{t.exports=e.x("node:child_process",()=>require("node:child_process"))},912714,(e,t,r)=>{t.exports=e.x("node:fs/promises",()=>require("node:fs/promises"))},812057,(e,t,r)=>{t.exports=e.x("node:util",()=>require("node:util"))},478500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},687769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},524836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},916020,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},757660,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s.default}});var a=e.r(916020);Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})});var s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&({}).hasOwnProperty.call(e,s)){var i=a?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(e.r(823667));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}Object.keys(s).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})})},442461,e=>e.a(async(t,r)=>{try{let t=await e.y("@xenova/transformers");e.n(t),r()}catch(e){r(e)}},!0),799160,e=>e.a(async(t,r)=>{try{var n=e.i(442461),a=e.i(843793),s=t([n]);[n]=s.then?(await s)():s;let o="Xenova/all-MiniLM-L6-v2";class i{static embedder=null;static async initialize(){this.embedder||(console.log(`[SEMANTIC] Initializing local embedder model: ${o}...`),this.embedder=await (0,n.pipeline)("feature-extraction",o),console.log("[SEMANTIC] Embedder initialized successfully"))}static async generateEmbedding(e){if(await this.initialize(),!e||!e.trim())throw Error("Text is required for embedding generation");let t=e.replace(/\n+/g," ").trim().substring(0,2e3);try{let e=await this.embedder(t,{pooling:"mean",normalize:!0});return Array.from(e.data)}catch(e){throw console.error("[SEMANTIC] Error generating embedding:",e),e}}static async updateSemanticVector(e){try{let t=await a.db.fileList.findUnique({where:{id:e},select:{title:!0,category:!0,note:!0}});if(!t)throw Error(`File with ID ${e} not found`);let r=`Title: ${t.title}. Category: ${t.category}. Content: ${t.note||""}`;console.log(`[SEMANTIC] Generating vector for file ${e} (${r.length} chars)...`);let n=await this.generateEmbedding(r);await a.db.$executeRaw`
				UPDATE file_list
				SET semantic_vector = ${JSON.stringify(n)}::vector
				WHERE id = ${e}
			`,console.log(`[SEMANTIC] Successfully updated vector for file ${e}`)}catch(t){console.error(`[SEMANTIC] Failed to update vector for file ${e}:`,t)}}static async generateChunkVectors(e){try{let t=await a.db.fileChunk.findMany({where:{file_id:e},select:{id:!0,content:!0}});for(let r of(console.log(`[SEMANTIC] Generating vectors for ${t.length} chunks of file ${e}...`),t))try{let e=await this.generateEmbedding(r.content);await a.db.$executeRaw`
						UPDATE file_chunks
						SET semantic_vector = ${JSON.stringify(e)}::vector
						WHERE id = ${r.id}
					`}catch(e){console.error(`[SEMANTIC] Failed to generate vector for chunk ${r.id}:`,e)}console.log(`[SEMANTIC] Successfully updated vectors for file ${e} chunks`)}catch(t){console.error(`[SEMANTIC] Failed to generate chunk vectors for file ${e}:`,t)}}static async batchUpdateSemanticVectors(){console.log("[SEMANTIC] Starting batch update for missing vectors...");let e=await a.db.$queryRaw`
			SELECT id FROM file_list WHERE semantic_vector IS NULL
		`;for(let t of(console.log(`[SEMANTIC] Found ${e.length} records to update.`),e))await this.updateSemanticVector(t.id);console.log("[SEMANTIC] Batch update completed.")}}e.s(["SemanticVectorService",()=>i]),r()}catch(e){r(e)}},!1),484199,(e,t,r)=>{"use strict";var n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,i={},l={VercelOidcTokenError:()=>u};for(var c in l)n(i,c,{get:l[c],enumerable:!0});t.exports=((e,t,r,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of s(t))o.call(e,r)||void 0===r||n(e,r,{get:()=>t[r],enumerable:!(i=a(t,r))||i.enumerable});return e})(n({},"__esModule",{value:!0}),i);class u extends Error{constructor(e,t){super(e),this.name="VercelOidcTokenError",this.cause=t}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}},168031,e=>{"use strict";var t=e.i(698043);let r=null;async function n(){return r||(r=(async()=>{try{await t.default.$executeRawUnsafe("SELECT pg_advisory_lock(hashtext('cid_ai_app_settings_ddl_lock'));");try{await t.default.$executeRawUnsafe(`CREATE TABLE IF NOT EXISTS app_settings (
            key TEXT PRIMARY KEY,
            value TEXT NOT NULL,
            created_at TIMESTAMPTZ DEFAULT NOW(),
            updated_at TIMESTAMPTZ DEFAULT NOW()
          );`),await t.default.$executeRawUnsafe(`CREATE OR REPLACE FUNCTION set_updated_at()
           RETURNS TRIGGER AS $$
           BEGIN
             NEW.updated_at = NOW();
             RETURN NEW;
           END;
           $$ LANGUAGE plpgsql;`),await t.default.$executeRawUnsafe(`DO $$
           BEGIN
             IF NOT EXISTS (
               SELECT 1 FROM pg_trigger WHERE tgname = 'app_settings_set_updated_at'
             ) THEN
               CREATE TRIGGER app_settings_set_updated_at
               BEFORE UPDATE ON app_settings
               FOR EACH ROW EXECUTE FUNCTION set_updated_at();
             END IF;
           END $$;`)}finally{await t.default.$executeRawUnsafe("SELECT pg_advisory_unlock(hashtext('cid_ai_app_settings_ddl_lock'));")}}catch(e){console.warn("[APP-SETTINGS] ensureTable failed (non-fatal)",e)}})())}async function a(e){try{await n();let r=await t.default.$queryRawUnsafe("SELECT value FROM app_settings WHERE key = $1 LIMIT 1",e);if(r&&r.length>0)return r[0].value;return null}catch(e){return console.warn("[APP-SETTINGS] getSetting failed",e),null}}async function s(e,r){await n(),await t.default.$executeRawUnsafe(`INSERT INTO app_settings (key, value)
     VALUES ($1, $2)
     ON CONFLICT (key) DO UPDATE SET value = EXCLUDED.value`,e,r)}async function o(e,t){let r=await a(e);if(null==r)return t;let n=Number(r);return!Number.isFinite(n)||n<=0?t:Math.floor(n)}async function i(e,t){if(!Number.isFinite(t)||t<=0)throw Error("Value must be a positive integer");await s(e,String(Math.floor(t)))}e.s(["getSettingInt",()=>o,"setSettingInt",()=>i])},423676,e=>e.a(async(t,r)=>{try{var n=e.i(89171),a=e.i(757660),s=e.i(856292),o=e.i(698043),i=e.i(946502),l=t([i]);async function c(e){try{let t=await (0,a.getServerSession)(s.authOptions);if(!t?.user?.role||"admin"!==t.user.role)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{questions:r,chapterId:l}=await e.json();if(!r||!Array.isArray(r)||0===r.length||!l)return n.NextResponse.json({error:"Missing questions or chapterId"},{status:400});console.log(`[GEN-ANSWERS] Generating answers for ${r.length} questions (Chapter ${l})...`);let c=await o.prisma.chapter.findUnique({where:{id:BigInt(l)},include:{subject:{include:{program:{include:{board:!0}}}},chunks:{orderBy:{chunk_index:"asc"},select:{content:!0}}}});if(!c)return n.NextResponse.json({error:"Chapter not found"},{status:404});let u=c.chunks.map(e=>e.content).join("\n\n");u||console.warn("[GEN-ANSWERS] No chapter content found. AI will rely on general knowledge.");let d=c.subject?.program?.board?.id||"",p=c.subject?.program?.name||"",h=c.subject?.name||"",f=c.title||"",g=[];try{let e=[];for(let t=0;t<r.length;t+=5)e.push(r.slice(t,t+5));console.log(`[GEN-ANSWERS] Processing ${r.length} questions in ${e.length} batches (Size: 5, Concurrency: 3)...`);for(let t=0;t<e.length;t+=3){let r=e.slice(t,t+3);console.log(`[GEN-ANSWERS] Processing batch set ${Math.floor(t/3)+1}/${Math.ceil(e.length/3)}...`),(await Promise.all(r.map(e=>(0,i.generateAnswersForBatch)(e,u,{board:d,level:p,subject:h,chapter:f})))).forEach(e=>{g.push(...e)})}}catch(e){return console.error("[GEN-ANSWERS] AI generation failed:",e),n.NextResponse.json({error:"AI generation failed: "+e.message},{status:500})}return n.NextResponse.json({success:!0,answers:g})}catch(e){return console.error("[GEN-ANSWERS] Error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}[i]=l.then?(await l)():l,e.s(["POST",()=>c]),r()}catch(e){r(e)}},!1),439016,e=>e.a(async(t,r)=>{try{var n=e.i(747909),a=e.i(174017),s=e.i(996250),o=e.i(759756),i=e.i(561916),l=e.i(114444),c=e.i(837092),u=e.i(869741),d=e.i(316795),p=e.i(487718),h=e.i(995169),f=e.i(47587),g=e.i(666012),E=e.i(570101),y=e.i(626937),x=e.i(10372),m=e.i(193695);e.i(52474);var v=e.i(257297),w=e.i(423676),R=t([w]);[w]=R.then?(await R)():R;let T=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/questions/generate-answers/route",pathname:"/api/admin/questions/generate-answers",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/admin/questions/generate-answers/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:S,workUnitAsyncStorage:_,serverHooks:A}=T;function b(){return(0,s.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:_})}async function N(e,t,r){T.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/admin/questions/generate-answers/route";n=n.replace(/\/index$/,"")||"/";let s=await T.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:R,nextConfig:b,parsedUrl:N,isDraftMode:S,prerenderManifest:_,routerServerContext:A,isOnDemandRevalidate:C,revalidateOnlyGenerated:O,resolvedPathname:I,clientReferenceManifest:P,serverActionsManifest:$}=s,j=(0,u.normalizeAppPath)(n),q=!!(_.dynamicRoutes[j]||_.routes[I]),k=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,N,!1):t.end("This page could not be found"),null);if(q&&!S){let e=!!_.routes[I],t=_.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await k();throw new m.NoFallbackError}}let M=null;!q||T.isDev||S||(M=I,M="/index"===M?"/":M);let U=!0===T.isDev||!q,D=q&&!U;$&&P&&(0,l.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:P,serverActionsManifest:$,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:$})});let F=e.method||"GET",L=(0,i.getTracer)(),H=L.getActiveScopeSpan(),G={params:R,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>T.onRequestError(e,t,n,A)},sharedContext:{buildId:w}},W=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),V=p.NextRequestAdapter.fromNodeNextRequest(W,(0,p.signalFromNodeResponse)(t));try{let s=async e=>T.handle(V,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${n}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),c=async o=>{var i,c;let u=async({previousCacheEntry:a})=>{try{if(!l&&C&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(o);e.fetchMetrics=G.renderOpts.fetchMetrics;let i=G.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let c=G.renderOpts.collectedTags;if(!q)return await (0,g.sendResponse)(W,B,n,G.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[x.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,a=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:C})},A),t}},d=await T.handleResponse({req:e,nextConfig:b,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!q)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,E.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&q||p.delete(x.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,y.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(W,B,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};H?await c(H):await L.withPropagatedContext(e.headers,()=>L.trace(h.BaseServerSpan.handleRequest,{spanName:`${F} ${n}`,kind:i.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},c))}catch(t){if(t instanceof m.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:C})}),q)throw t;return await (0,g.sendResponse)(W,B,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>b,"routeModule",()=>T,"serverHooks",()=>A,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>_]),r()}catch(e){r(e)}},!1),967030,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__6cacdf68._.js"].map(t=>e.l(t))).then(()=>t(783697)))},683671,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__d51507ad._.js"].map(t=>e.l(t))).then(()=>t(390391)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__842b1b1b._.js.map