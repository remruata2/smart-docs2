module.exports=[916020,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},757660,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return i.default}});var a=e.r(916020);Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})});var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&({}).hasOwnProperty.call(e,i)){var u=a?Object.getOwnPropertyDescriptor(e,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(e.r(823667));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})})},219166,e=>{"use strict";var t=e.i(757660),r=e.i(856292),n=e.i(237295),a=e.i(487848);async function i(e,i){try{if("true"===process.env.DISABLE_USAGE_LIMITS)return console.log("[USAGE-LIMITS] Usage limits disabled (development mode or DISABLE_USAGE_LIMITS=true)"),{allowed:!0,currentUsage:0,limit:-1};if(!i){let e=await (0,t.getServerSession)(r.authOptions);if(!e?.user?.id)return{allowed:!1,reason:"Authentication required"};i=parseInt(e.user.id)}let s=(await (0,a.getUserLimits)(i))["file_upload"===e?"files":"chat_message"===e?"chats":"exports"];if(-1===s)return{allowed:!0,currentUsage:0,limit:-1};let u=await (0,n.getCurrentUsage)(i,e),o=u<s;return{allowed:o,currentUsage:u,limit:s,reason:o?void 0:`You have reached your ${e.replace("_"," ")} limit of ${s}. Please upgrade your plan.`}}catch(e){return console.error("[USAGE-LIMITS] Error checking usage limit:",e),{allowed:!1,reason:"Error checking usage limits"}}}async function s(e,t){if("true"===process.env.DISABLE_USAGE_LIMITS)return console.log("[USAGE-LIMITS] Usage limits disabled (development mode or DISABLE_USAGE_LIMITS=true)"),{success:!0};let r=await i(e,t);return r.allowed?{success:!0}:{success:!1,error:r.reason||"Usage limit exceeded",status:429}}e.s(["checkUsageLimit",()=>i,"enforceUsageLimit",()=>s])},237295,e=>{"use strict";var t=e.i(843793),r=e.i(660724),n=e.i(121741),a=e.i(278052);async function i(e,s,u=1,o){let c=new Date,d=(0,n.startOfMonth)(c),l=(0,a.endOfMonth)(c),f=await t.db.usageTracking.findFirst({where:{user_id:e,usage_type:s,period_start:d,period_end:l}});return f?await t.db.usageTracking.update({where:{id:f.id},data:{count:f.count+u,metadata:o?{...f.metadata,...o}:null===f.metadata?r.Prisma.JsonNull:f.metadata}}):await t.db.usageTracking.create({data:{user_id:e,usage_type:s,count:u,period_start:d,period_end:l,metadata:o||{}}})}async function s(e,r){let i=new Date,s=(0,n.startOfMonth)(i),u=(0,a.endOfMonth)(i),o=await t.db.usageTracking.findFirst({where:{user_id:e,usage_type:r,period_start:s,period_end:u}});return o?.count||0}async function u(e){let r=new Date,i=(0,n.startOfMonth)(r),s=(0,a.endOfMonth)(r),u=await t.db.usageTracking.findMany({where:{user_id:e,period_start:i,period_end:s}}),o={file_upload:0,chat_message:0,document_export:0,ai_processing:0,quiz_generation:0,battle_match:0,ai_tutor_session:0};return u.forEach(e=>{o[e.usage_type]=e.count}),o}async function o(e,t,r){return await s(e,t)>=r}async function c(e,t,r){return!await o(e,t,r)}async function d(e){let r=new Date,i=(0,n.startOfMonth)(r),s=(0,a.endOfMonth)(r);return await t.db.usageTracking.findMany({where:{user_id:e,period_start:{gte:i,lte:s}},orderBy:{created_at:"desc"}})}e.s(["canPerformAction",()=>c,"getAllCurrentUsage",()=>u,"getCurrentUsage",()=>s,"getUserUsageStats",()=>d,"hasExceededLimit",()=>o,"trackUsage",()=>i])},487848,e=>{"use strict";var t=e.i(843793),r=e.i(660724);async function n(e){return await t.db.subscriptionPlan.findUnique({where:{id:e}})}async function a(){return await t.db.subscriptionPlan.findMany({where:{is_active:!0},orderBy:{price_monthly:"asc"}})}async function i(){return await t.db.subscriptionPlan.findFirst({where:{is_default:!0,is_active:!0}})}async function s(e){return await t.db.userSubscription.findUnique({where:{user_id:e},include:{plan:!0}})}async function u(e,n){let{planId:a,razorpaySubscriptionId:i,razorpayCustomerId:s,razorpayOrderId:u,status:o=r.SubscriptionStatus.active,billingCycle:c=r.BillingCycle.monthly,currentPeriodStart:d,currentPeriodEnd:l}=n;return await t.db.userSubscription.upsert({where:{user_id:e},update:{plan_id:a,razorpay_subscription_id:i,razorpay_customer_id:s,razorpay_order_id:u,status:o,billing_cycle:c,current_period_start:d,current_period_end:l},create:{user_id:e,plan_id:a,razorpay_subscription_id:i,razorpay_customer_id:s,razorpay_order_id:u,status:o,billing_cycle:c,current_period_start:d,current_period_end:l},include:{plan:!0}})}async function o(e,r){return await t.db.userSubscription.update({where:{user_id:e},data:{status:r},include:{plan:!0}})}async function c(e){let t=await s(e);if(!t){let e=await i();return e?e.limits:(console.warn("[SUBSCRIPTION-SERVICE] No default plan found, using fallback free tier limits"),{files:10,chats:20,exports:5})}return t.plan.limits}e.s(["getActivePlans",()=>a,"getDefaultPlan",()=>i,"getSubscriptionPlan",()=>n,"getUserLimits",()=>c,"updateSubscriptionStatus",()=>o,"upsertUserSubscription",()=>u])},121741,278052,e=>{"use strict";let t=Symbol.for("constructDateFrom");function r(e,r){var n;return n=r||e,"function"==typeof n?n(e):n&&"object"==typeof n&&t in n?n[t](e):n instanceof Date?new n.constructor(e):new Date(e)}function n(e,t){let n=r(e,t?.in);return n.setDate(1),n.setHours(0,0,0,0),n}function a(e,t){let n=r(e,t?.in),a=n.getMonth();return n.setFullYear(n.getFullYear(),a+1,0),n.setHours(23,59,59,999),n}e.s(["startOfMonth",()=>n],121741),e.s(["endOfMonth",()=>a],278052)}];

//# sourceMappingURL=_e7edf65f._.js.map