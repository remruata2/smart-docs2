module.exports=[193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},843793,e=>{"use strict";var t=e.i(660724);let r=global.prisma||new t.PrismaClient;e.s(["db",0,r])},698043,e=>{"use strict";let t=e.i(843793).db;e.s(["default",0,t,"prisma",0,t])},145706,(e,t,r)=>{t.exports=e.x("querystring",()=>require("querystring"))},575096,e=>{e.v({name:"openid-client",version:"5.7.1",description:"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs",keywords:["auth","authentication","basic","certified","client","connect","dynamic","electron","hybrid","identity","implicit","oauth","oauth2","oidc","openid","passport","relying party","strategy"],homepage:"https://github.com/panva/openid-client",repository:"panva/openid-client",funding:{url:"https://github.com/sponsors/panva"},license:"MIT",author:"Filip Skokan <panva.ip@gmail.com>",exports:{types:"./types/index.d.ts",import:"./lib/index.mjs",require:"./lib/index.js"},main:"./lib/index.js",types:"./types/index.d.ts",files:["lib","types/index.d.ts"],scripts:{format:"npx prettier --loglevel silent --write ./lib ./test ./certification ./types",test:"mocha test/**/*.test.js"},dependencies:{jose:"^4.15.9","lru-cache":"^6.0.0","object-hash":"^2.2.0","oidc-token-hash":"^5.0.3"},devDependencies:{"@types/node":"^16.18.106","@types/passport":"^1.0.16",base64url:"^3.0.1",chai:"^4.5.0",mocha:"^10.7.3",nock:"^13.5.5",prettier:"^2.8.8","readable-mock-req":"^0.2.2",sinon:"^9.2.4",timekeeper:"^2.3.1"},"standard-version":{scripts:{postchangelog:"sed -i '' -e 's/### \\[/## [/g' CHANGELOG.md"},types:[{type:"feat",section:"Features"},{type:"fix",section:"Fixes"},{type:"chore",hidden:!0},{type:"docs",hidden:!0},{type:"style",hidden:!0},{type:"refactor",section:"Refactor",hidden:!1},{type:"perf",section:"Performance",hidden:!1},{type:"test",hidden:!0}]}})},500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},449719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},224361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},427699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},59639,(e,t,r)=>{t.exports=e.x("node:process",()=>require("node:process"))},660526,(e,t,r)=>{t.exports=e.x("node:os",()=>require("node:os"))},509656,(e,t,r)=>{t.exports=e.x("node:tty",()=>require("node:tty"))},902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},874533,(e,t,r)=>{t.exports=e.x("node:child_process",()=>require("node:child_process"))},912714,(e,t,r)=>{t.exports=e.x("node:fs/promises",()=>require("node:fs/promises"))},812057,(e,t,r)=>{t.exports=e.x("node:util",()=>require("node:util"))},478500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},687769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},524836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},916020,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},757660,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return a.default}});var n=e.r(916020);Object.keys(n).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)||e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})});var a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(void 0);if(r&&r.has(e))return r.get(e);var i={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&({}).hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(i,a,o):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}(e.r(823667));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})})},442461,e=>e.a(async(t,r)=>{try{let t=await e.y("@xenova/transformers");e.n(t),r()}catch(e){r(e)}},!0),79832,e=>{"use strict";e.s(["isAdmin",0,e=>"admin"===e])},219166,e=>{"use strict";var t=e.i(757660),r=e.i(856292),i=e.i(237295),n=e.i(487848);async function a(e,a){try{if("true"===process.env.DISABLE_USAGE_LIMITS)return console.log("[USAGE-LIMITS] Usage limits disabled (development mode or DISABLE_USAGE_LIMITS=true)"),{allowed:!0,currentUsage:0,limit:-1};if(!a){let e=await (0,t.getServerSession)(r.authOptions);if(!e?.user?.id)return{allowed:!1,reason:"Authentication required"};a=parseInt(e.user.id)}let s=(await (0,n.getUserLimits)(a))["file_upload"===e?"files":"chat_message"===e?"chats":"exports"];if(-1===s)return{allowed:!0,currentUsage:0,limit:-1};let o=await (0,i.getCurrentUsage)(a,e),c=o<s;return{allowed:c,currentUsage:o,limit:s,reason:c?void 0:`You have reached your ${e.replace("_"," ")} limit of ${s}. Please upgrade your plan.`}}catch(e){return console.error("[USAGE-LIMITS] Error checking usage limit:",e),{allowed:!1,reason:"Error checking usage limits"}}}async function s(e,t){if("true"===process.env.DISABLE_USAGE_LIMITS)return console.log("[USAGE-LIMITS] Usage limits disabled (development mode or DISABLE_USAGE_LIMITS=true)"),{success:!0};let r=await a(e,t);return r.allowed?{success:!0}:{success:!1,error:r.reason||"Usage limit exceeded",status:429}}e.s(["checkUsageLimit",()=>a,"enforceUsageLimit",()=>s])},237295,e=>{"use strict";var t=e.i(843793),r=e.i(660724),i=e.i(121741),n=e.i(278052);async function a(e,s,o=1,c){let l=new Date,u=(0,i.startOfMonth)(l),d=(0,n.endOfMonth)(l),p=await t.db.usageTracking.findFirst({where:{user_id:e,usage_type:s,period_start:u,period_end:d}});return p?await t.db.usageTracking.update({where:{id:p.id},data:{count:p.count+o,metadata:c?{...p.metadata,...c}:null===p.metadata?r.Prisma.JsonNull:p.metadata}}):await t.db.usageTracking.create({data:{user_id:e,usage_type:s,count:o,period_start:u,period_end:d,metadata:c||{}}})}async function s(e,r){let a=new Date,s=(0,i.startOfMonth)(a),o=(0,n.endOfMonth)(a),c=await t.db.usageTracking.findFirst({where:{user_id:e,usage_type:r,period_start:s,period_end:o}});return c?.count||0}async function o(e){let r=new Date,a=(0,i.startOfMonth)(r),s=(0,n.endOfMonth)(r),o=await t.db.usageTracking.findMany({where:{user_id:e,period_start:a,period_end:s}}),c={file_upload:0,chat_message:0,document_export:0,ai_processing:0,quiz_generation:0,battle_match:0,ai_tutor_session:0};return o.forEach(e=>{c[e.usage_type]=e.count}),c}async function c(e,t,r){return await s(e,t)>=r}async function l(e,t,r){return!await c(e,t,r)}async function u(e){let r=new Date,a=(0,i.startOfMonth)(r),s=(0,n.endOfMonth)(r);return await t.db.usageTracking.findMany({where:{user_id:e,period_start:{gte:a,lte:s}},orderBy:{created_at:"desc"}})}e.s(["canPerformAction",()=>l,"getAllCurrentUsage",()=>o,"getCurrentUsage",()=>s,"getUserUsageStats",()=>u,"hasExceededLimit",()=>c,"trackUsage",()=>a])},487848,e=>{"use strict";var t=e.i(843793),r=e.i(660724);async function i(e){return await t.db.subscriptionPlan.findUnique({where:{id:e}})}async function n(){return await t.db.subscriptionPlan.findMany({where:{is_active:!0},orderBy:{price_monthly:"asc"}})}async function a(){return await t.db.subscriptionPlan.findFirst({where:{is_default:!0,is_active:!0}})}async function s(e){return await t.db.userSubscription.findUnique({where:{user_id:e},include:{plan:!0}})}async function o(e,i){let{planId:n,razorpaySubscriptionId:a,razorpayCustomerId:s,razorpayOrderId:o,status:c=r.SubscriptionStatus.active,billingCycle:l=r.BillingCycle.monthly,currentPeriodStart:u,currentPeriodEnd:d}=i;return await t.db.userSubscription.upsert({where:{user_id:e},update:{plan_id:n,razorpay_subscription_id:a,razorpay_customer_id:s,razorpay_order_id:o,status:c,billing_cycle:l,current_period_start:u,current_period_end:d},create:{user_id:e,plan_id:n,razorpay_subscription_id:a,razorpay_customer_id:s,razorpay_order_id:o,status:c,billing_cycle:l,current_period_start:u,current_period_end:d},include:{plan:!0}})}async function c(e,r){return await t.db.userSubscription.update({where:{user_id:e},data:{status:r},include:{plan:!0}})}async function l(e){let t=await s(e);if(!t){let e=await a();return e?e.limits:(console.warn("[SUBSCRIPTION-SERVICE] No default plan found, using fallback free tier limits"),{files:10,chats:20,exports:5})}return t.plan.limits}e.s(["getActivePlans",()=>n,"getDefaultPlan",()=>a,"getSubscriptionPlan",()=>i,"getUserLimits",()=>l,"updateSubscriptionStatus",()=>c,"upsertUserSubscription",()=>o])},121741,278052,e=>{"use strict";let t=Symbol.for("constructDateFrom");function r(e,r){var i;return i=r||e,"function"==typeof i?i(e):i&&"object"==typeof i&&t in i?i[t](e):i instanceof Date?new i.constructor(e):new Date(e)}function i(e,t){let i=r(e,t?.in);return i.setDate(1),i.setHours(0,0,0,0),i}function n(e,t){let i=r(e,t?.in),n=i.getMonth();return i.setFullYear(i.getFullYear(),n+1,0),i.setHours(23,59,59,999),i}e.s(["startOfMonth",()=>i],121741),e.s(["endOfMonth",()=>n],278052)},799160,e=>e.a(async(t,r)=>{try{var i=e.i(442461),n=e.i(843793),a=t([i]);[i]=a.then?(await a)():a;let s="Xenova/all-MiniLM-L6-v2";class o{static embedder=null;static async initialize(){this.embedder||(console.log(`[SEMANTIC] Initializing local embedder model: ${s}...`),this.embedder=await (0,i.pipeline)("feature-extraction",s),console.log("[SEMANTIC] Embedder initialized successfully"))}static async generateEmbedding(e){if(await this.initialize(),!e||!e.trim())throw Error("Text is required for embedding generation");let t=e.replace(/\n+/g," ").trim().substring(0,2e3);try{let e=await this.embedder(t,{pooling:"mean",normalize:!0});return Array.from(e.data)}catch(e){throw console.error("[SEMANTIC] Error generating embedding:",e),e}}static async updateSemanticVector(e){try{let t=await n.db.fileList.findUnique({where:{id:e},select:{title:!0,category:!0,note:!0}});if(!t)throw Error(`File with ID ${e} not found`);let r=`Title: ${t.title}. Category: ${t.category}. Content: ${t.note||""}`;console.log(`[SEMANTIC] Generating vector for file ${e} (${r.length} chars)...`);let i=await this.generateEmbedding(r);await n.db.$executeRaw`
				UPDATE file_list
				SET semantic_vector = ${JSON.stringify(i)}::vector
				WHERE id = ${e}
			`,console.log(`[SEMANTIC] Successfully updated vector for file ${e}`)}catch(t){console.error(`[SEMANTIC] Failed to update vector for file ${e}:`,t)}}static async generateChunkVectors(e){try{let t=await n.db.fileChunk.findMany({where:{file_id:e},select:{id:!0,content:!0}});for(let r of(console.log(`[SEMANTIC] Generating vectors for ${t.length} chunks of file ${e}...`),t))try{let e=await this.generateEmbedding(r.content);await n.db.$executeRaw`
						UPDATE file_chunks
						SET semantic_vector = ${JSON.stringify(e)}::vector
						WHERE id = ${r.id}
					`}catch(e){console.error(`[SEMANTIC] Failed to generate vector for chunk ${r.id}:`,e)}console.log(`[SEMANTIC] Successfully updated vectors for file ${e} chunks`)}catch(t){console.error(`[SEMANTIC] Failed to generate chunk vectors for file ${e}:`,t)}}static async batchUpdateSemanticVectors(){console.log("[SEMANTIC] Starting batch update for missing vectors...");let e=await n.db.$queryRaw`
			SELECT id FROM file_list WHERE semantic_vector IS NULL
		`;for(let t of(console.log(`[SEMANTIC] Found ${e.length} records to update.`),e))await this.updateSemanticVector(t.id);console.log("[SEMANTIC] Batch update completed.")}}e.s(["SemanticVectorService",()=>o]),r()}catch(e){r(e)}},!1),484199,(e,t,r)=>{"use strict";var i=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,o={},c={VercelOidcTokenError:()=>u};for(var l in c)i(o,l,{get:c[l],enumerable:!0});t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))s.call(e,r)||void 0===r||i(e,r,{get:()=>t[r],enumerable:!(o=n(t,r))||o.enumerable});return e})(i({},"__esModule",{value:!0}),o);class u extends Error{constructor(e,t){super(e),this.name="VercelOidcTokenError",this.cause=t}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}},168031,e=>{"use strict";var t=e.i(698043);let r=null;async function i(){return r||(r=(async()=>{try{await t.default.$executeRawUnsafe("SELECT pg_advisory_lock(hashtext('cid_ai_app_settings_ddl_lock'));");try{await t.default.$executeRawUnsafe(`CREATE TABLE IF NOT EXISTS app_settings (
            key TEXT PRIMARY KEY,
            value TEXT NOT NULL,
            created_at TIMESTAMPTZ DEFAULT NOW(),
            updated_at TIMESTAMPTZ DEFAULT NOW()
          );`),await t.default.$executeRawUnsafe(`CREATE OR REPLACE FUNCTION set_updated_at()
           RETURNS TRIGGER AS $$
           BEGIN
             NEW.updated_at = NOW();
             RETURN NEW;
           END;
           $$ LANGUAGE plpgsql;`),await t.default.$executeRawUnsafe(`DO $$
           BEGIN
             IF NOT EXISTS (
               SELECT 1 FROM pg_trigger WHERE tgname = 'app_settings_set_updated_at'
             ) THEN
               CREATE TRIGGER app_settings_set_updated_at
               BEFORE UPDATE ON app_settings
               FOR EACH ROW EXECUTE FUNCTION set_updated_at();
             END IF;
           END $$;`)}finally{await t.default.$executeRawUnsafe("SELECT pg_advisory_unlock(hashtext('cid_ai_app_settings_ddl_lock'));")}}catch(e){console.warn("[APP-SETTINGS] ensureTable failed (non-fatal)",e)}})())}async function n(e){try{await i();let r=await t.default.$queryRawUnsafe("SELECT value FROM app_settings WHERE key = $1 LIMIT 1",e);if(r&&r.length>0)return r[0].value;return null}catch(e){return console.warn("[APP-SETTINGS] getSetting failed",e),null}}async function a(e,r){await i(),await t.default.$executeRawUnsafe(`INSERT INTO app_settings (key, value)
     VALUES ($1, $2)
     ON CONFLICT (key) DO UPDATE SET value = EXCLUDED.value`,e,r)}async function s(e,t){let r=await n(e);if(null==r)return t;let i=Number(r);return!Number.isFinite(i)||i<=0?t:Math.floor(i)}async function o(e,t){if(!Number.isFinite(t)||t<=0)throw Error("Value must be a positive integer");await a(e,String(Math.floor(t)))}e.s(["getSettingInt",()=>s,"setSettingInt",()=>o])},249526,e=>{"use strict";function t(e,r=1e3){let i=[],n=e;for(let e of(n.length>r&&(n=n.slice(0,r),i.push("length_exceeded")),n!==(n=n.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/g,""))&&i.push("control_characters"),[/ignore\s+(?:all\s+)?(?:previous|above|prior)\s+(?:instructions?|prompts?|rules?)/gi,/disregard\s+(?:all\s+)?(?:previous|above|prior)\s+(?:instructions?|prompts?)/gi,/you\s+are\s+now\s+(?:a\s+)?(?:different|new)/gi,/act\s+as\s+(?:a\s+)?(?:different|new)/gi,/pretend\s+(?:you\s+are|to\s+be)/gi,/system\s*:?\s*(?:override|bypass|ignore)/gi]))e.test(n)&&(n=n.replace(e,"[REDACTED]"),i.push("injection_attempt"));for(let e of(n!==(n=n.replace(/([\\'"`;{}[\]()<>]){3,}/g,"$1$1"))&&i.push("excessive_special_chars"),[/;\s*(?:drop|delete|truncate|alter|create)\s+(?:table|database)/gi,/union\s+(?:all\s+)?select/gi,/(?:exec|execute)\s*\(/gi]))e.test(n)&&(n=n.replace(e,"[REDACTED]"),i.push("sql_injection_attempt"));return{sanitized:(n=n.replace(/\n{4,}/g,"\n\n\n")).trim(),wasModified:e!==n,removedPatterns:i}}function r(e,i=20,n=1e3){if(!Array.isArray(e))return{valid:!1,error:"conversationHistory must be an array"};if(e.length>i)return{valid:!1,error:`conversationHistory too long (max ${i} messages)`};let a=[];for(let r=0;r<e.length;r++){let i=e[r];if("object"!=typeof i||null===i)return{valid:!1,error:`Message ${r} is not an object`};if(!i.role||!["user","assistant"].includes(i.role))return{valid:!1,error:`Message ${r} has invalid role`};if(!i.content||"string"!=typeof i.content)return{valid:!1,error:`Message ${r} has invalid content`};if("user"===i.role&&i.content.length>n)return{valid:!1,error:`Message ${r} content too long (max ${n} characters)`};let s=t(i.content,n);a.push({role:i.role,content:s.sanitized,id:"string"==typeof i.id?i.id:void 0,timestamp:i.timestamp})}return{valid:!0,sanitized:a}}e.s(["sanitizeAIInput",()=>t,"validateConversationHistory",()=>r])},341890,e=>{"use strict";class t{cache;options;constructor(e){this.cache=new Map,this.options=e,setInterval(()=>this.cleanup(),6e4)}cleanup(){let e=Date.now();for(let[t,r]of this.cache.entries())e>r.resetAt&&this.cache.delete(t)}async check(e){let t=Date.now(),r=this.cache.get(e);(!r||t>r.resetAt)&&(r={count:0,resetAt:t+this.options.windowMs}),r.count++,this.cache.set(e,r);let i=r.count<=this.options.max;return{allowed:i,remaining:Math.max(0,this.options.max-r.count),resetIn:r.resetAt-t,resetAt:new Date(r.resetAt)}}reset(e){this.cache.delete(e)}}let r=new t({windowMs:6e4,max:10});new t({windowMs:6e4,max:30}),e.s(["chatRateLimiter",0,r])},967030,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__6cacdf68._.js"].map(t=>e.l(t))).then(()=>t(783697)))},683671,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__d51507ad._.js"].map(t=>e.l(t))).then(()=>t(390391)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__0f51ec0d._.js.map