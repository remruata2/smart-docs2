{"version":3,"sources":["../../../../src/services/user-service.ts","../../../../src/app/admin/users/%5Bid%5D/UserDetailClient.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/admin/users/%5Bid%5D/page.tsx"],"sourcesContent":["import { db } from \"@/lib/db\";\nimport { UserRole } from \"@/generated/prisma\";\nimport { hash } from \"bcryptjs\";\n\n/**\n * Get all users from the database\n */\nexport async function getAllUsers() {\n\tconsole.log(\"[USER-SERVICE] Fetching all users...\");\n\ttry {\n\t\tconst users = await db.user.findMany({\n\t\t\tselect: {\n\t\t\t\tid: true,\n\t\t\t\tusername: true,\n\t\t\t\trole: true,\n\t\t\t\tis_active: true,\n\t\t\t\tlast_login: true,\n\t\t\t\tcreated_at: true,\n\t\t\t},\n\t\t\torderBy: {\n\t\t\t\tcreated_at: \"desc\",\n\t\t\t},\n\t\t});\n\t\tconsole.log(`[USER-SERVICE] Found ${users.length} users:`, users);\n\t\treturn users;\n\t} catch (error) {\n\t\tconsole.error(\"[USER-SERVICE] Error fetching users:\", error);\n\t\tthrow error;\n\t}\n}\n\n/**\n * Get a user by ID\n */\nexport async function getUserById(id: number) {\n\treturn await db.user.findUnique({\n\t\twhere: { id },\n\t\tselect: {\n\t\t\tid: true,\n\t\t\tusername: true,\n\t\t\trole: true,\n\t\t\tis_active: true,\n\t\t\tlast_login: true,\n\t\t\tcreated_at: true,\n\t\t},\n\t});\n}\n\n/**\n * Create a new user\n */\nexport async function createUser(data: {\n\tusername: string;\n\tpassword: string;\n\trole: UserRole;\n\tis_active?: boolean;\n}) {\n\tconst { username, password, role, is_active = true } = data;\n\n\t// Hash the password\n\tconst password_hash = await hash(password, 10);\n\n\treturn await db.user.create({\n\t\tdata: {\n\t\t\tusername,\n\t\t\tpassword_hash,\n\t\t\trole,\n\t\t\tis_active,\n\t\t},\n\t\tselect: {\n\t\t\tid: true,\n\t\t\tusername: true,\n\t\t\trole: true,\n\t\t\tis_active: true,\n\t\t\tcreated_at: true,\n\t\t},\n\t});\n}\n\n/**\n * Update a user\n */\nexport async function updateUser(\n\tid: number,\n\tdata: {\n\t\tusername?: string;\n\t\tpassword?: string;\n\t\trole?: UserRole;\n\t\tis_active?: boolean;\n\t}\n) {\n\tconst { username, password, role, is_active } = data;\n\n\t// Prepare update data\n\tconst updateData: any = {};\n\n\tif (username !== undefined) {\n\t\tupdateData.username = username;\n\t}\n\n\tif (password !== undefined) {\n\t\tupdateData.password_hash = await hash(password, 10);\n\t}\n\n\tif (role !== undefined) {\n\t\tupdateData.role = role;\n\t}\n\n\tif (is_active !== undefined) {\n\t\tupdateData.is_active = is_active;\n\t}\n\n\treturn await db.user.update({\n\t\twhere: { id },\n\t\tdata: updateData,\n\t\tselect: {\n\t\t\tid: true,\n\t\t\tusername: true,\n\t\t\trole: true,\n\t\t\tis_active: true,\n\t\t\tlast_login: true,\n\t\t\tcreated_at: true,\n\t\t},\n\t});\n}\n\n/**\n * Delete a user\n */\nexport async function deleteUser(id: number) {\n\treturn await db.user.delete({\n\t\twhere: { id },\n\t});\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/users/[id]/UserDetailClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/users/[id]/UserDetailClient.tsx\",\n    \"default\",\n);\n","// This is now a Server Component\nimport { getServerSession } from 'next-auth/next';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth-options';\nimport { getUserById } from '@/services/user-service';\nimport { UserRole } from '@/generated/prisma';\nimport UserDetailClient, { UserDetailProps } from './UserDetailClient'; // Import the new client component\n\nexport default async function UserDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  const session = await getServerSession(authOptions);\n\n  // Check if user is authenticated and is an admin\n  if (!session || !session.user || session.user.role !== UserRole.admin) {\n    redirect('/unauthorized'); // Or your preferred unauthorized/login page\n  }\n  \n  const { id: paramId } = await params;\n  const userId = parseInt(paramId, 10);\n  let user: UserDetailProps | null = null;\n  let error: string | null = null;\n  let loading = true; // Start with loading true\n\n  if (isNaN(userId)) {\n    error = 'Invalid user ID.';\n    loading = false;\n  } else {\n    try {\n      const rawUser = await getUserById(userId);\n      if (rawUser) {\n        user = {\n          ...rawUser,\n          // Ensure Date objects are converted to ISO strings for serialization\n          last_login: rawUser.last_login ? new Date(rawUser.last_login).toISOString() : null,\n          created_at: rawUser.created_at ? new Date(rawUser.created_at).toISOString() : null,\n        };\n      } else {\n        error = 'User not found.';\n      }\n    } catch (err: any) {\n      console.error('Failed to fetch user:', err);\n      error = 'Failed to load user details. Please try again.';\n    } finally {\n      loading = false;\n    }\n  }\n\n  // Pass the fetched data (or error/loading state) to the client component\n  return <UserDetailClient user={user} loading={loading} error={error} />;\n}\n\n"],"names":[],"mappings":"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","ignoreList":[1]}