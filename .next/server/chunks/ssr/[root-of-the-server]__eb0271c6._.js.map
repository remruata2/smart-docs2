{"version":3,"sources":["../../../../src/components/admin/FilterSelect.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/admin/chapters/chapter-list-client.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/admin/chapters/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/admin/FilterSelect.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/admin/FilterSelect.tsx\",\n    \"default\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/chapters/chapter-list-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/chapters/chapter-list-client.tsx\",\n    \"default\",\n);\n","import { prisma } from \"@/lib/prisma\";\nimport { redirect } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth-options\";\nimport { isAdmin } from \"@/lib/auth\";\nimport FilterSelect from \"@/components/admin/FilterSelect\";\nimport ChapterListClient from \"./chapter-list-client\";\nimport { deleteChapters } from \"./actions\";\n\nexport default async function ChaptersPage({\n    searchParams,\n}: {\n    searchParams: Promise<{ boardId?: string; subjectId?: string }>;\n}) {\n    const session = await getServerSession(authOptions);\n    if (!session?.user || !isAdmin((session.user as any).role)) {\n        redirect(\"/\");\n    }\n\n    const { boardId, subjectId } = await searchParams;\n\n    // Build filter\n    const where: any = {};\n    if (boardId) {\n        // Filter by accessible boards (array contains boardId OR is global)\n        where.OR = [\n            { accessible_boards: { has: boardId } },\n            { is_global: true }\n        ];\n    }\n    if (subjectId) {\n        where.subject_id = parseInt(subjectId);\n    }\n\n    const chapters = await prisma.chapter.findMany({\n        where,\n        include: {\n            subject: {\n                include: {\n                    program: {\n                        include: {\n                            board: true,\n                        },\n                    },\n                },\n            },\n            _count: {\n                select: { chunks: true, pages: true },\n            },\n        },\n        orderBy: { created_at: \"desc\" },\n    });\n\n    const boards = await prisma.board.findMany({ where: { is_active: true } });\n    const subjects = await prisma.subject.findMany({\n        where: { is_active: true },\n        include: {\n            program: {\n                include: {\n                    board: true,\n                },\n            },\n        },\n    });\n\n    // Serialize BigInt for client component\n    const serializedChapters = chapters.map(ch => ({\n        ...ch,\n        id: ch.id.toString(),\n        subject_id: ch.subject_id,\n    }));\n\n    return (\n        <div className=\"container mx-auto py-10\">\n            <div className=\"flex justify-between items-center mb-8\">\n                <h1 className=\"text-3xl font-bold\">Chapters Management</h1>\n                <Link href=\"/admin/chapters/new\" className=\"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700\">\n                    Ingest New Chapter\n                </Link>\n            </div>\n\n            {/* Filters */}\n            <div className=\"bg-white p-4 rounded-lg shadow mb-8 flex gap-4\">\n                <FilterSelect\n                    name=\"boardId\"\n                    placeholder=\"All Boards\"\n                    options={boards.map(b => ({ value: b.id, label: b.name }))}\n                />\n                <FilterSelect\n                    name=\"subjectId\"\n                    placeholder=\"All Subjects\"\n                    options={subjects.map(s => ({ value: s.id.toString(), label: `${s.name} (${s.program.name} - ${s.program.board.name})` }))}\n                />\n            </div>\n\n            {/* Chapters List with Selection */}\n            <ChapterListClient chapters={serializedChapters} onDelete={deleteChapters} />\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}