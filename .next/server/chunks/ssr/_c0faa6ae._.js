module.exports=[298841,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0})},20971,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={};Object.defineProperty(c,"default",{enumerable:!0,get:function(){return f.default}});var e=a.r(298841);Object.keys(e).forEach(function(a){"default"===a||"__esModule"===a||Object.prototype.hasOwnProperty.call(d,a)||a in c&&c[a]===e[a]||Object.defineProperty(c,a,{enumerable:!0,get:function(){return e[a]}})});var f=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=g(void 0);if(c&&c.has(a))return c.get(a);var d={__proto__:null},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&({}).hasOwnProperty.call(a,f)){var h=e?Object.getOwnPropertyDescriptor(a,f):null;h&&(h.get||h.set)?Object.defineProperty(d,f,h):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}(a.r(794431));function g(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(g=function(a){return a?c:b})(a)}Object.keys(f).forEach(function(a){"default"===a||"__esModule"===a||Object.prototype.hasOwnProperty.call(d,a)||a in c&&c[a]===f[a]||Object.defineProperty(c,a,{enumerable:!0,get:function(){return f[a]}})})},399602,696818,18956,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInWeek",0,6048e5],696818),a.s(["constructFrom",()=>c],18956),a.s(["toDate",()=>d],399602)},108530,a=>{"use strict";var b=a.i(761469),c=a.i(107341),d=a.i(399602);function e(a,b){let c=(0,d.toDate)(a,b?.in);return c.setDate(1),c.setHours(0,0,0,0),c}function f(a,b){let c=(0,d.toDate)(a,b?.in),e=c.getMonth();return c.setFullYear(c.getFullYear(),e+1,0),c.setHours(23,59,59,999),c}async function g(a,d,h=1,i){let j=new Date,k=e(j),l=f(j),m=await b.db.usageTracking.findFirst({where:{user_id:a,usage_type:d,period_start:k,period_end:l}});return m?await b.db.usageTracking.update({where:{id:m.id},data:{count:m.count+h,metadata:i?{...m.metadata,...i}:null===m.metadata?c.Prisma.JsonNull:m.metadata}}):await b.db.usageTracking.create({data:{user_id:a,usage_type:d,count:h,period_start:k,period_end:l,metadata:i||{}}})}async function h(a,c){let d=new Date,g=e(d),h=f(d),i=await b.db.usageTracking.findFirst({where:{user_id:a,usage_type:c,period_start:g,period_end:h}});return i?.count||0}async function i(a){let c=new Date,d=e(c),g=f(c),h=await b.db.usageTracking.findMany({where:{user_id:a,period_start:d,period_end:g}}),i={file_upload:0,chat_message:0,document_export:0,ai_processing:0,quiz_generation:0,battle_match:0,ai_tutor_session:0};return h.forEach(a=>{i[a.usage_type]=a.count}),i}async function j(a,b,c){return await h(a,b)>=c}async function k(a,b,c){return!await j(a,b,c)}async function l(a){let c=new Date,d=e(c),g=f(c);return await b.db.usageTracking.findMany({where:{user_id:a,period_start:{gte:d,lte:g}},orderBy:{created_at:"desc"}})}a.s(["canPerformAction",()=>k,"getAllCurrentUsage",()=>i,"getCurrentUsage",()=>h,"getUserUsageStats",()=>l,"hasExceededLimit",()=>j,"trackUsage",()=>g],108530)},934796,a=>{"use strict";var b=a.i(20971),c=a.i(547256),d=a.i(108530),e=a.i(761469);async function f(){return await e.db.subscriptionPlan.findFirst({where:{is_default:!0,is_active:!0}})}async function g(a){return await e.db.userSubscription.findUnique({where:{user_id:a},include:{plan:!0}})}async function h(a){let b=await g(a);if(!b){let a=await f();return a?a.limits:(console.warn("[SUBSCRIPTION-SERVICE] No default plan found, using fallback free tier limits"),{files:10,chats:20,exports:5})}return b.plan.limits}async function i(a,e){try{if("true"===process.env.DISABLE_USAGE_LIMITS)return console.log("[USAGE-LIMITS] Usage limits disabled (development mode or DISABLE_USAGE_LIMITS=true)"),{allowed:!0,currentUsage:0,limit:-1};if(!e){let a=await (0,b.getServerSession)(c.authOptions);if(!a?.user?.id)return{allowed:!1,reason:"Authentication required"};e=parseInt(a.user.id)}let f=(await h(e))["file_upload"===a?"files":"chat_message"===a?"chats":"exports"];if(-1===f)return{allowed:!0,currentUsage:0,limit:-1};let g=await (0,d.getCurrentUsage)(e,a),i=g<f;return{allowed:i,currentUsage:g,limit:f,reason:i?void 0:`You have reached your ${a.replace("_"," ")} limit of ${f}. Please upgrade your plan.`}}catch(a){return console.error("[USAGE-LIMITS] Error checking usage limit:",a),{allowed:!1,reason:"Error checking usage limits"}}}async function j(a,b){if("true"===process.env.DISABLE_USAGE_LIMITS)return console.log("[USAGE-LIMITS] Usage limits disabled (development mode or DISABLE_USAGE_LIMITS=true)"),{success:!0};let c=await i(a,b);return c.allowed?{success:!0}:{success:!1,error:c.reason||"Usage limit exceeded",status:429}}a.i(107341),a.s(["checkUsageLimit",()=>i,"enforceUsageLimit",()=>j],934796)}];

//# sourceMappingURL=_c0faa6ae._.js.map