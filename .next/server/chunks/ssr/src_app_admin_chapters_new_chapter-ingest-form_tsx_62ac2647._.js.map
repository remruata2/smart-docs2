{"version":3,"sources":["../../../../src/app/admin/chapters/new/chapter-ingest-form.tsx","../../../../src/lib/textbook-splitter.ts","../../../../src/app/admin/chapters/new/question-bank-config.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from \"react\";\nimport { batchCreateChapters, analyzeTextbook } from \"@/app/actions/admin\";\nimport { ingestChapterAsync } from \"../actions-async\";\nimport { useRouter } from \"next/navigation\";\nimport { toast } from \"sonner\";\nimport { TextbookSplitter, DetectedChapter, LlamaParsePageResult } from \"@/lib/textbook-splitter\";\nimport { QuestionBankConfig, QuestionBankConfigState } from \"./question-bank-config\";\n\ninterface Board {\n    id: string;\n    name: string;\n}\n\ninterface Program {\n    id: number;\n    name: string;\n    board: { id: string; name: string };\n    institution: { id: bigint; name: string } | null;\n}\n\ninterface Subject {\n    id: number;\n    name: string;\n    program: {\n        id: number;\n        name: string;\n        board: { id: string; name: string };\n    };\n}\n\ntype UploadMode = 'individual' | 'textbook';\n\nexport default function ChapterIngestForm({\n    boards,\n    programs,\n    subjects\n}: {\n    boards: Board[];\n    programs: Program[];\n    subjects: Subject[];\n}) {\n    const router = useRouter();\n    const [uploadMode, setUploadMode] = useState<UploadMode>('individual');\n    const [isLoading, setIsLoading] = useState(false);\n    const [selectedProgram, setSelectedProgram] = useState<number | \"\">(\"\");\n\n    // Individual mode state\n    const [uploadingFiles, setUploadingFiles] = useState<Array<{\n        file: File;\n        status: 'pending' | 'uploading' | 'success' | 'error';\n        error?: string;\n        title: string;\n        subjectId: string;\n        chapterNumber: string;\n        accessibleBoards: string[];\n    }>>([]);\n\n    // Textbook mode state\n    const [textbookFile, setTextbookFile] = useState<File | null>(null);\n    const [isAnalyzing, setIsAnalyzing] = useState(false);\n    const [detectedChapters, setDetectedChapters] = useState<DetectedChapter[]>([]);\n    const [fullPages, setFullPages] = useState<LlamaParsePageResult[]>([]);\n    const [textbookSubjectId, setTextbookSubjectId] = useState<string>(\"\");\n    const [textbookBoards, setTextbookBoards] = useState<string[]>([]);\n\n    // Question Bank Config\n    const [questionConfig, setQuestionConfig] = useState<QuestionBankConfigState | null>(null);\n\n    // Filter subjects based on selected program\n    const filteredSubjects = selectedProgram\n        ? subjects.filter(s => s.program.id === selectedProgram)\n        : subjects;\n\n    function handleFileSelect(e: React.ChangeEvent<HTMLInputElement>) {\n        const files = e.target.files;\n        if (!files || files.length === 0) {\n            setUploadingFiles([]);\n            return;\n        }\n\n        if (files.length > 5) {\n            toast.error(\"Maximum 5 files allowed per upload\");\n            e.target.value = \"\";\n            return;\n        }\n\n        const maxSize = 100 * 1024 * 1024;\n        const oversizedFiles = Array.from(files).filter(f => f.size > maxSize);\n        if (oversizedFiles.length > 0) {\n            toast.error(`${oversizedFiles.length} file(s) too large. Maximum size is 100MB.`);\n            e.target.value = \"\";\n            return;\n        }\n\n        const fileRecords = Array.from(files).map(file => ({\n            file,\n            status: 'pending' as const,\n            title: file.name.replace(/\\.pdf$/i, \"\"),\n            subjectId: \"\",\n            chapterNumber: \"\",\n            accessibleBoards: [] as string[],\n        }));\n\n        setUploadingFiles(fileRecords);\n    }\n\n    async function handleTextbookAnalyze() {\n        if (!textbookFile) {\n            toast.error(\"Please select a textbook PDF\");\n            return;\n        }\n\n        setIsAnalyzing(true);\n        try {\n            // SERVER-SIDE: Extract text using API route (avoids bundling issues)\n            const formData = new FormData();\n            formData.append('file', textbookFile);\n\n            const response = await fetch('/api/extract-pdf-text', {\n                method: 'POST',\n                body: formData,\n            });\n\n            if (!response.ok) {\n                const error = await response.json();\n                throw new Error(error.error || 'Failed to extract PDF text');\n            }\n\n            const { pages } = await response.json();\n\n            // Detect chapters from extracted text\n            const chapters = await TextbookSplitter.detectChapters(pages);\n\n            setFullPages(pages);\n            setDetectedChapters(chapters);\n\n            toast.success(`Detected ${chapters.length} chapter(s) - Ready to save!`);\n        } catch (error: any) {\n            toast.error(error.message || \"Failed to analyze textbook\");\n            console.error(\"Textbook analysis error:\", error);\n        } finally {\n            setIsAnalyzing(false);\n        }\n    }\n\n    async function handleIndividualSubmit(e: React.FormEvent) {\n        e.preventDefault();\n\n        if (uploadingFiles.length === 0) {\n            toast.error(\"Please select at least one PDF file\");\n            return;\n        }\n\n        const invalidFiles = uploadingFiles.filter(f => !f.subjectId);\n        if (invalidFiles.length > 0) {\n            toast.error(\"Please select a subject for all files\");\n            return;\n        }\n\n        setIsLoading(true);\n        let successCount = 0;\n        let errorCount = 0;\n\n        for (let i = 0; i < uploadingFiles.length; i++) {\n            const fileRecord = uploadingFiles[i];\n\n            setUploadingFiles(prev => {\n                const updated = [...prev];\n                updated[i] = { ...updated[i], status: 'uploading' };\n                return updated;\n            });\n\n            try {\n                const formData = new FormData();\n                formData.append(\"file\", fileRecord.file);\n                formData.append(\"title\", fileRecord.title);\n                formData.append(\"subjectId\", fileRecord.subjectId);\n                if (fileRecord.chapterNumber) {\n                    formData.append(\"chapterNumber\", fileRecord.chapterNumber);\n                }\n\n                if (fileRecord.accessibleBoards.length > 0) {\n                    fileRecord.accessibleBoards.forEach(boardId => {\n                        formData.append(\"accessibleBoards\", boardId);\n                    });\n                }\n\n                if (questionConfig) {\n                    formData.append(\"questionConfig\", JSON.stringify(questionConfig));\n                }\n\n                // Use async action\n                const result = await ingestChapterAsync(formData);\n\n                if (result.success) {\n                    successCount++;\n                    setUploadingFiles(prev => {\n                        const updated = [...prev];\n                        updated[i] = { ...updated[i], status: 'success' };\n                        return updated;\n                    });\n                } else {\n                    errorCount++;\n                    setUploadingFiles(prev => {\n                        const updated = [...prev];\n                        updated[i] = { ...updated[i], status: 'error', error: result.error };\n                        return updated;\n                    });\n                }\n            } catch (err) {\n                errorCount++;\n                const errorMessage = err instanceof Error ? err.message : \"Unknown error\";\n                setUploadingFiles(prev => {\n                    const updated = [...prev];\n                    updated[i] = { ...updated[i], status: 'error', error: errorMessage };\n                    return updated;\n                });\n            }\n        }\n\n        if (successCount > 0) {\n            toast.success(`Started processing ${successCount} chapter(s).`);\n        }\n        if (errorCount > 0) {\n            toast.error(`Failed to upload ${errorCount} chapter(s).`);\n        }\n\n        setIsLoading(false);\n\n        if (successCount > 0 && errorCount === 0) {\n            setTimeout(() => {\n                router.push(\"/admin/chapters\");\n                router.refresh();\n            }, 1000);\n        }\n    }\n\n    async function handleTextbookSubmit(e: React.FormEvent) {\n        e.preventDefault();\n\n        if (!textbookSubjectId) {\n            toast.error(\"Please select a subject\");\n            return;\n        }\n\n        if (detectedChapters.length === 0) {\n            toast.error(\"No chapters detected. Please analyze the textbook first.\");\n            return;\n        }\n\n        setIsLoading(true);\n        try {\n            const formData = new FormData();\n            formData.append(\"subjectId\", textbookSubjectId);\n            formData.append(\"chapters\", JSON.stringify(detectedChapters));\n            formData.append(\"fullPages\", JSON.stringify(fullPages));\n\n            if (textbookBoards.length > 0) {\n                textbookBoards.forEach(boardId => {\n                    formData.append(\"accessibleBoards\", boardId);\n                });\n            }\n\n            if (textbookFile) {\n                formData.append(\"file\", textbookFile);\n            }\n\n            if (questionConfig) {\n                formData.append(\"questionConfig\", JSON.stringify(questionConfig));\n            }\n\n            // Use async action - creates chapters immediately with PENDING status\n            const { batchCreateChaptersAsync } = await import('../actions-async');\n            const result = await batchCreateChaptersAsync(formData);\n\n            if (result.success) {\n                toast.success(result.message || `Created ${detectedChapters.length} chapters - Processing in background`);\n                // Redirect immediately - no waiting!\n                router.push(\"/admin/chapters\");\n                router.refresh();\n            } else {\n                toast.error(result.error || \"Failed to create chapters\");\n                setIsLoading(false);\n            }\n        } catch (error: any) {\n            toast.error(error.message || \"Failed to create chapters\");\n            setIsLoading(false);\n        }\n    }\n\n    function updateChapter(id: string, updates: Partial<DetectedChapter>) {\n        setDetectedChapters(prev => prev.map(ch =>\n            ch.id === id ? { ...ch, ...updates } : ch\n        ));\n    }\n\n    function deleteChapter(id: string) {\n        setDetectedChapters(prev => prev.filter(ch => ch.id !== id));\n    }\n\n    function mergeChapters(id1: string, id2: string) {\n        const ch1 = detectedChapters.find(c => c.id === id1);\n        const ch2 = detectedChapters.find(c => c.id === id2);\n\n        if (!ch1 || !ch2) return;\n\n        const merged = TextbookSplitter.mergeChapters(ch1, ch2);\n        setDetectedChapters(prev => prev\n            .filter(c => c.id !== id1 && c.id !== id2)\n            .concat(merged)\n            .sort((a, b) => a.startPage - b.startPage)\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Upload Mode Selection */}\n            <div className=\"bg-white p-6 rounded-lg shadow\">\n                <h2 className=\"text-lg font-semibold mb-4\">Upload Mode</h2>\n                <div className=\"flex gap-4\">\n                    <label className=\"flex items-center space-x-2 cursor-pointer\">\n                        <input\n                            type=\"radio\"\n                            checked={uploadMode === 'individual'}\n                            onChange={() => setUploadMode('individual')}\n                            className=\"w-4 h-4 text-indigo-600\"\n                        />\n                        <span className=\"text-sm font-medium\">Individual Chapters (up to 5 files)</span>\n                    </label>\n                    <label className=\"flex items-center space-x-2 cursor-pointer\">\n                        <input\n                            type=\"radio\"\n                            checked={uploadMode === 'textbook'}\n                            onChange={() => setUploadMode('textbook')}\n                            className=\"w-4 h-4 text-indigo-600\"\n                        />\n                        <span className=\"text-sm font-medium\">Whole Textbook (auto-split)</span>\n                    </label>\n                </div>\n            </div>\n\n            {/* Individual Chapters Mode */}\n            {uploadMode === 'individual' && (\n                <form onSubmit={handleIndividualSubmit} className=\"space-y-6 bg-white p-6 rounded-lg shadow\">\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Filter by Program (Optional)\n                        </label>\n                        <select\n                            value={selectedProgram}\n                            onChange={(e) => setSelectedProgram(e.target.value ? parseInt(e.target.value) : \"\")}\n                            className=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2\"\n                        >\n                            <option value=\"\">All Programs</option>\n                            {programs.map((p) => (\n                                <option key={p.id} value={p.id}>\n                                    {p.name} ({p.board.name}{p.institution ? ` - ${p.institution.name}` : \"\"})\n                                </option>\n                            ))}\n                        </select>\n                    </div>\n\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            PDF Files *\n                            {uploadingFiles.length > 0 && (\n                                <span className=\"ml-2 text-sm text-gray-500\">\n                                    ({uploadingFiles.filter(f => f.status === 'success').length}/{uploadingFiles.length} uploaded)\n                                </span>\n                            )}\n                        </label>\n                        <input\n                            type=\"file\"\n                            accept=\".pdf\"\n                            multiple\n                            onChange={handleFileSelect}\n                            disabled={isLoading}\n                            className=\"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 disabled:opacity-50\"\n                        />\n                        <p className=\"mt-1 text-xs text-gray-500\">\n                            Upload up to 5 PDF files (max 100MB each).\n                        </p>\n                    </div>\n\n                    {/* File List - Same as before (keeping existing code) */}\n                    {uploadingFiles.length > 0 && (\n                        <div className=\"space-y-4\">\n                            <h3 className=\"font-medium text-gray-900\">Files to Upload</h3>\n                            {uploadingFiles.map((fileRecord, index) => (\n                                <div key={index} className=\"p-4 border rounded-md bg-gray-50 space-y-3\">\n                                    <div className=\"flex items-center justify-between\">\n                                        <div className=\"flex-1 min-w-0\">\n                                            <p className=\"text-sm font-medium truncate\">{fileRecord.file.name}</p>\n                                            <p className=\"text-xs text-gray-500\">\n                                                {(fileRecord.file.size / 1024 / 1024).toFixed(2)} MB\n                                            </p>\n                                        </div>\n                                        {fileRecord.status !== 'pending' && (\n                                            <span className={`ml-2 px-2 py-1 text-xs font-semibold rounded-full ${fileRecord.status === 'uploading' ? 'bg-blue-100 text-blue-800' :\n                                                fileRecord.status === 'success' ? 'bg-green-100 text-green-800' :\n                                                    'bg-red-100 text-red-800'\n                                                }`}>\n                                                {fileRecord.status}\n                                            </span>\n                                        )}\n                                    </div>\n\n                                    <div className=\"grid grid-cols-2 gap-3\">\n                                        <div>\n                                            <label className=\"block text-xs font-medium text-gray-700 mb-1\">Title *</label>\n                                            <input\n                                                type=\"text\"\n                                                value={fileRecord.title}\n                                                onChange={(e) => {\n                                                    const updated = [...uploadingFiles];\n                                                    updated[index].title = e.target.value;\n                                                    setUploadingFiles(updated);\n                                                }}\n                                                disabled={isLoading}\n                                                className=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border p-2\"\n                                            />\n                                        </div>\n\n                                        <div>\n                                            <label className=\"block text-xs font-medium text-gray-700 mb-1\">Chapter Number</label>\n                                            <input\n                                                type=\"number\"\n                                                value={fileRecord.chapterNumber}\n                                                onChange={(e) => {\n                                                    const updated = [...uploadingFiles];\n                                                    updated[index].chapterNumber = e.target.value;\n                                                    setUploadingFiles(updated);\n                                                }}\n                                                disabled={isLoading}\n                                                placeholder=\"Optional\"\n                                                className=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border p-2\"\n                                            />\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-700 mb-1\">Subject *</label>\n                                        <select\n                                            value={fileRecord.subjectId}\n                                            onChange={(e) => {\n                                                const updated = [...uploadingFiles];\n                                                updated[index].subjectId = e.target.value;\n                                                setUploadingFiles(updated);\n                                            }}\n                                            disabled={isLoading}\n                                            className=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border p-2\"\n                                        >\n                                            <option value=\"\">Select Subject</option>\n                                            {filteredSubjects.map((s) => (\n                                                <option key={s.id} value={s.id}>\n                                                    {s.name} ({s.program.name} - {s.program.board.name})\n                                                </option>\n                                            ))}\n                                        </select>\n                                    </div>\n\n                                    <div>\n                                        <label className=\"block text-xs font-medium text-gray-700 mb-1\">Accessible Boards</label>\n                                        <p className=\"text-xs text-gray-500 mb-1\">Hold Ctrl/Cmd to select multiple.</p>\n                                        <select\n                                            multiple\n                                            value={fileRecord.accessibleBoards}\n                                            onChange={(e) => {\n                                                const selected = Array.from(e.target.selectedOptions, option => option.value);\n                                                const updated = [...uploadingFiles];\n                                                updated[index].accessibleBoards = selected;\n                                                setUploadingFiles(updated);\n                                            }}\n                                            disabled={isLoading}\n                                            className=\"block w-full rounded-md border-gray-300 shadow-sm text-sm border p-2 h-24\"\n                                        >\n                                            <option value=\"GLOBAL\">GLOBAL (All Boards)</option>\n                                            {boards.map((b) => (\n                                                <option key={b.id} value={b.id}>{b.name}</option>\n                                            ))}\n                                        </select>\n                                    </div>\n\n                                    {fileRecord.error && (\n                                        <div className=\"text-xs text-red-600 bg-red-50 p-2 rounded\">\n                                            Error: {fileRecord.error}\n                                        </div>\n                                    )}\n                                </div>\n                            ))}\n                        </div>\n                    )}\n\n                    <QuestionBankConfig onChange={setQuestionConfig} />\n\n                    <div className=\"flex justify-end gap-3\">\n                        <button\n                            type=\"button\"\n                            onClick={() => router.back()}\n                            disabled={isLoading}\n                            className=\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50\"\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            type=\"submit\"\n                            disabled={isLoading || uploadingFiles.length === 0}\n                            className=\"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                        >\n                            {isLoading ? \"Ingesting...\" : `Ingest ${uploadingFiles.length} Chapter(s)`}\n                        </button>\n                    </div>\n                </form>\n            )}\n\n            {/* Textbook Mode */}\n            {uploadMode === 'textbook' && (\n                <form onSubmit={handleTextbookSubmit} className=\"space-y-6 bg-white p-6 rounded-lg shadow\">\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Textbook PDF *\n                        </label>\n                        <input\n                            type=\"file\"\n                            accept=\".pdf\"\n                            onChange={(e) => {\n                                const file = e.target.files?.[0];\n                                if (file) {\n                                    if (file.size > 500 * 1024 * 1024) {\n                                        toast.error(\"File too large. Maximum size is 500MB.\");\n                                        e.target.value = \"\";\n                                        return;\n                                    }\n                                    setTextbookFile(file);\n                                    setDetectedChapters([]);\n                                }\n                            }}\n                            disabled={isLoading || isAnalyzing}\n                            className=\"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100\"\n                        />\n                        <p className=\"mt-1 text-xs text-gray-500\">\n                            Upload a complete textbook PDF (max 500MB). System will auto-detect chapters.\n                        </p>\n                    </div>\n\n                    {textbookFile && detectedChapters.length === 0 && (\n                        <div>\n                            {!isAnalyzing ? (\n                                <button\n                                    type=\"button\"\n                                    onClick={handleTextbookAnalyze}\n                                    disabled={isAnalyzing}\n                                    className=\"w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50\"\n                                >\n                                    Analyze & Detect Chapters\n                                </button>\n                            ) : (\n                                <div className=\"w-full border border-blue-200 rounded-lg p-6 bg-blue-50\">\n                                    <div className=\"flex flex-col items-center space-y-4\">\n                                        {/* Animated Spinner */}\n                                        <div className=\"relative\">\n                                            <div className=\"w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin\"></div>\n                                            <div className=\"absolute inset-0 flex items-center justify-center\">\n                                                <svg className=\"w-8 h-8 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                                                </svg>\n                                            </div>\n                                        </div>\n\n                                        {/* Progress Text */}\n                                        <div className=\"text-center\">\n                                            <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n                                                Analyzing Textbook...\n                                            </h3>\n                                            <p className=\"text-sm text-gray-600 mb-2\">\n                                                Processing PDF with LlamaParse AI\n                                            </p>\n                                            <p className=\"text-xs text-gray-500\">\n                                                This may take 1-3 minutes for large files. Please wait...\n                                            </p>\n                                        </div>\n\n                                        {/* Animated Progress Dots */}\n                                        <div className=\"flex space-x-2\">\n                                            <div className=\"w-2 h-2 bg-blue-600 rounded-full animate-bounce\" style={{ animationDelay: '0s' }}></div>\n                                            <div className=\"w-2 h-2 bg-blue-600 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                                            <div className=\"w-2 h-2 bg-blue-600 rounded-full animate-bounce\" style={{ animationDelay: '0.4s' }}></div>\n                                        </div>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    )}\n\n                    {/* Detected Chapters Preview */}\n                    {detectedChapters.length > 0 && (\n                        <>\n                            <div>\n                                <h3 className=\"font-medium text-gray-900 mb-4\">\n                                    Detected {detectedChapters.length} Chapter(s)\n                                </h3>\n\n                                <div className=\"grid grid-cols-2 gap-4 max-h-96 overflow-y-auto\">\n                                    {detectedChapters.map((chapter, index) => (\n                                        <div key={chapter.id} className=\"border rounded-lg p-4 bg-gray-50 space-y-2\">\n                                            <div className=\"flex justify-between items-start\">\n                                                <span className=\"text-xs font-semibold text-gray-500\">Chapter {index + 1}</span>\n                                                <button\n                                                    type=\"button\"\n                                                    onClick={() => deleteChapter(chapter.id)}\n                                                    className=\"text-red-600 hover:text-red-800 text-xs\"\n                                                >\n                                                    Delete\n                                                </button>\n                                            </div>\n\n                                            <input\n                                                type=\"text\"\n                                                value={chapter.title}\n                                                onChange={(e) => updateChapter(chapter.id, { title: e.target.value })}\n                                                className=\"w-full text-sm font-medium border rounded px-2 py-1\"\n                                            />\n\n                                            <div className=\"text-xs text-gray-600\">\n                                                Pages {chapter.startPage}-{chapter.endPage}\n                                            </div>\n\n                                            <p className=\"text-xs text-gray-500 line-clamp-3\">\n                                                {chapter.previewText}\n                                            </p>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Subject *</label>\n                                <select\n                                    value={textbookSubjectId}\n                                    onChange={(e) => setTextbookSubjectId(e.target.value)}\n                                    className=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border p-2\"\n                                >\n                                    <option value=\"\">Select Subject</option>\n                                    {subjects.map((s) => (\n                                        <option key={s.id} value={s.id}>\n                                            {s.name} ({s.program.name} - {s.program.board.name})\n                                        </option>\n                                    ))}\n                                </select>\n                                <p className=\"mt-1 text-xs text-gray-500\">\n                                    All detected chapters will be created under this subject.\n                                </p>\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Accessible Boards</label>\n                                <select\n                                    multiple\n                                    value={textbookBoards}\n                                    onChange={(e) => {\n                                        const selected = Array.from(e.target.selectedOptions, option => option.value);\n                                        setTextbookBoards(selected);\n                                    }}\n                                    className=\"block w-full rounded-md border-gray-300 shadow-sm text-sm border p-2 h-24\"\n                                >\n                                    <option value=\"GLOBAL\">GLOBAL (All Boards)</option>\n                                    {boards.map((b) => (\n                                        <option key={b.id} value={b.id}>{b.name}</option>\n                                    ))}\n                                </select>\n                                <p className=\"mt-1 text-xs text-gray-500\">\n                                    applies to all chapters in this textbook.\n                                </p>\n                            </div>\n\n                            <QuestionBankConfig onChange={setQuestionConfig} />\n\n                            <div className=\"flex justify-end gap-3\">\n                                <button\n                                    type=\"button\"\n                                    onClick={() => {\n                                        setDetectedChapters([]);\n                                        setTextbookFile(null);\n                                    }}\n                                    disabled={isLoading}\n                                    className=\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50\"\n                                >\n                                    Start Over\n                                </button>\n                                <button\n                                    type=\"submit\"\n                                    disabled={isLoading || !textbookSubjectId}\n                                    className=\"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                                >\n                                    {isLoading ? \"Creating...\" : `Create ${detectedChapters.length} Chapters`}\n                                </button>\n                            </div>\n                        </>\n                    )}\n                </form>\n            )}\n        </div>\n    );\n}\n","/**\n * Smart Textbook Splitter\n * Automatically detects chapter boundaries in textbook PDFs\n */\n\nexport interface DetectedChapter {\n    id: string; // Temporary ID for UI\n    title: string;\n    startPage: number;\n    endPage: number;\n    content: string; // Markdown content for this chapter\n    previewText: string; // First 200 chars for preview\n    chapterNumber: number | null;\n}\n\nexport interface LlamaParsePageResult {\n    page: number;\n    text: string;\n    md: string;\n    width?: number;\n    height?: number;\n    items?: any;\n}\n\nexport class TextbookSplitter {\n    /**\n     * Detect chapters from LlamaParse page results\n     */\n    static async detectChapters(\n        pages: LlamaParsePageResult[]\n    ): Promise<DetectedChapter[]> {\n        const detectedChapters: DetectedChapter[] = [];\n        const chapterBoundaries: Array<{ page: number; title: string; chapterNum: number | null }> = [];\n\n        let lastDetectedChapterNum: number | null = null;\n\n        // 1. Find chapter boundaries by analyzing text patterns\n        for (const page of pages) {\n            const text = page.text || page.md || '';\n            const chapterMatch = this.findChapterMarker(text);\n\n            if (chapterMatch) {\n                // Only accept this as a new chapter if:\n                // - It's the first chapter we've seen, OR\n                // - The chapter number is greater than the last one we detected\n                const shouldAccept =\n                    lastDetectedChapterNum === null ||\n                    (chapterMatch.number !== null && chapterMatch.number > lastDetectedChapterNum);\n\n                if (shouldAccept) {\n                    chapterBoundaries.push({\n                        page: page.page,\n                        title: chapterMatch.title,\n                        chapterNum: chapterMatch.number\n                    });\n                    lastDetectedChapterNum = chapterMatch.number;\n                }\n            }\n        }\n\n        // If no chapters detected, treat entire book as one chapter\n        if (chapterBoundaries.length === 0) {\n            return [{\n                id: `detected-chapter-1`,\n                title: 'Complete Textbook',\n                startPage: pages[0]?.page || 1,\n                endPage: pages[pages.length - 1]?.page || pages.length,\n                content: pages.map(p => p.md || p.text).join('\\n\\n'),\n                previewText: this.extractPreview(pages[0]?.md || pages[0]?.text || ''),\n                chapterNumber: null\n            }];\n        }\n\n        // 2. Create chapter objects from boundaries\n        for (let i = 0; i < chapterBoundaries.length; i++) {\n            const boundary = chapterBoundaries[i];\n            const nextBoundary = chapterBoundaries[i + 1];\n\n            const startPage = boundary.page;\n            const endPage = nextBoundary ? nextBoundary.page - 1 : pages[pages.length - 1].page;\n\n            // Extract pages for this chapter\n            const chapterPages = pages.filter(p => p.page >= startPage && p.page <= endPage);\n            const content = chapterPages.map(p => p.md || p.text).join('\\n\\n');\n\n            detectedChapters.push({\n                id: `detected-chapter-${i + 1}`,\n                title: boundary.title,\n                startPage,\n                endPage,\n                content,\n                previewText: this.extractPreview(content),\n                chapterNumber: boundary.chapterNum\n            });\n        }\n\n        return detectedChapters;\n    }\n\n    /**\n     * Find chapter markers in text using regex patterns\n     */\n    private static findChapterMarker(text: string): { title: string; number: number | null } | null {\n        // Clean text to remove extra whitespace\n        const cleanText = text.trim();\n\n        // Pattern 0: Quote/Preceding text + Chapter + Multi-line Title\n        // Handles cases where there's a quote or other text before the chapter header\n        // and the title spans multiple lines.\n        // Example:\n        // \"Facts are not science...\"\n        // Chapter 1\n        // Chemical Reactions\n        // and Equations\n        const quotePattern = /(?:^|[\\r\\n]+)(?:(?:.*?)[\\r\\n]+){0,6}\\s*(?:CHAPTER|Chapter)\\s+(\\d+)\\s*[\\r\\n]+\\s*([^\\r\\n]{3,100})(?:[\\r\\n]+\\s*([^\\r\\n]{3,100}))?[\\r\\n]+([\\s\\S]{50,})/i;\n        const quoteMatch = cleanText.match(quotePattern);\n\n        if (quoteMatch) {\n            const chapterNum = this.parseChapterNumber(quoteMatch[1]);\n            let titlePart1 = quoteMatch[2].trim();\n            let titlePart2 = quoteMatch[3]?.trim();\n            const followingContent = quoteMatch[4];\n\n            // Validate Title Part 1\n            // If it looks like body text (too long or ends with period), ignore\n            if (titlePart1.length > 100 || /[.]$/.test(titlePart1)) {\n                // Fallback: maybe Part 1 is actually body text?\n                // But \"Chapter X\" was found, so it's likely a chapter.\n                // We'll accept it but be cautious about Part 2.\n            }\n\n            let fullTitle = titlePart1;\n\n            // Validate Title Part 2 (optional)\n            if (titlePart2) {\n                const isShort = titlePart2.length < 60;\n                const startsWithLower = /^[a-z]/.test(titlePart2);\n                const isContinuation = /^(?:and|of|the|in|on|at|to|for|with)\\b/i.test(titlePart2);\n\n                // If it's short OR starts with lowercase OR starts with a connector, treat as title\n                if (isShort || startsWithLower || isContinuation) {\n                    fullTitle += ' ' + titlePart2;\n                }\n            }\n\n            // Ensure title isn't just a page number or header artifact\n            if (!/^[A-Z\\s]+\\d+$/.test(fullTitle)) {\n                return { title: fullTitle, number: chapterNum };\n            }\n        }\n\n        // Pattern 1: Multi-line format - \"Chapter 1\" on one line, \"Title\" on next line\n        // This handles textbooks where chapter number and title are on separate lines (opening pages)\n        const multiLinePattern = /^(?:Chapter|CHAPTER|Ch\\.?)\\s+(\\d+|One|Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten|Eleven|Twelve|[IVX]+)\\s*\\n\\s*([A-Z][^\\n]{3,100})/i;\n        const multiLineMatch = cleanText.match(multiLinePattern);\n        if (multiLineMatch) {\n            const chapterNum = this.parseChapterNumber(multiLineMatch[1]);\n            let title = multiLineMatch[2].trim();\n\n            // Skip if title looks like it's just a page header variant (e.g., \"INTRODUCTION 2\")\n            if (/^[A-Z\\s]+\\d+$/.test(title)) {\n                return null;\n            }\n\n            title = title.replace(/\\s+/g, ' ').trim();\n            if (title.length > 100) {\n                title = title.substring(0, 97) + '...';\n            }\n\n            return { title, number: chapterNum };\n        }\n\n        // Pattern 2: Single-line ONLY if at start of text with LOTS of content after\n        // This avoids matching page headers which are typically short/isolated\n        // Must have at least 200 characters of content after the chapter line\n        const singleLinePattern = /^(?:Chapter|CHAPTER|Ch\\.?)\\s+(\\d+|One|Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten|Eleven|Twelve|[IVX]+)\\s*[:\\.\\-–—\\s]+\\s*([A-Z][^\\n]{3,100})\\n([\\s\\S]{200,})/i;\n        const singleLineMatch = cleanText.match(singleLinePattern);\n        if (singleLineMatch) {\n            const chapterNum = this.parseChapterNumber(singleLineMatch[1]);\n            let title = singleLineMatch[2]?.trim() || '';\n\n            // Skip if title looks like a sequential header (e.g., \"INTRODUCTION 2\", \"INTRODUCTION 3\")\n            if (/^[A-Z\\s]+\\d+$/.test(title)) {\n                return null;\n            }\n\n            if (!title || title.length < 3) {\n                title = `Chapter ${chapterNum || singleLineMatch[1]}`;\n            }\n\n            title = title.replace(/\\s+/g, ' ').trim();\n            if (title.length > 100) {\n                title = title.substring(0, 97) + '...';\n            }\n\n            return { title, number: chapterNum };\n        }\n\n        // Pattern 3: \"Unit X: Title\" with content requirement\n        const unitPattern = /^(?:Unit|UNIT)\\s+(\\d+)\\s*[:–-]\\s*(.+?)\\n([\\s\\S]{200,})/i;\n        const unitMatch = cleanText.match(unitPattern);\n        if (unitMatch) {\n            const chapterNum = this.parseChapterNumber(unitMatch[1]);\n            let title = unitMatch[2]?.trim() || '';\n\n            title = title.replace(/\\s+/g, ' ').trim();\n            if (title.length > 100) {\n                title = title.substring(0, 97) + '...';\n            }\n\n            return { title, number: chapterNum };\n        }\n\n        // Pattern 4: \"CHAPTER X\" standalone - but only if followed by substantial content\n        const standalonePattern = /^(?:CHAPTER|Chapter)\\s+(\\d+|[IVX]+)\\s*\\n([\\s\\S]{200,})/i;\n        const standaloneMatch = cleanText.match(standalonePattern);\n        if (standaloneMatch) {\n            const chapterNum = this.parseChapterNumber(standaloneMatch[1]);\n            const title = `Chapter ${chapterNum || standaloneMatch[1]}`;\n\n            return { title, number: chapterNum };\n        }\n\n        return null;\n    }\n\n    /**\n     * Parse chapter number from string (handles digits, words, roman numerals)\n     */\n    private static parseChapterNumber(str: string): number | null {\n        // Try digit first\n        const digitMatch = str.match(/\\d+/);\n        if (digitMatch) {\n            return parseInt(digitMatch[0]);\n        }\n\n        // Word to number\n        const wordToNum: Record<string, number> = {\n            'one': 1, 'two': 2, 'three': 3, 'four': 4, 'five': 5,\n            'six': 6, 'seven': 7, 'eight': 8, 'nine': 9, 'ten': 10\n        };\n        const word = str.toLowerCase();\n        if (wordToNum[word]) {\n            return wordToNum[word];\n        }\n\n        // Roman numerals\n        const romanMatch = str.match(/^[IVX]+$/i);\n        if (romanMatch) {\n            return this.romanToInt(romanMatch[0].toUpperCase());\n        }\n\n        return null;\n    }\n\n    /**\n     * Convert roman numerals to integer\n     */\n    private static romanToInt(s: string): number {\n        const roman: Record<string, number> = { I: 1, V: 5, X: 10, L: 50, C: 100 };\n        let result = 0;\n\n        for (let i = 0; i < s.length; i++) {\n            const current = roman[s[i]];\n            const next = roman[s[i + 1]];\n\n            if (next && current < next) {\n                result -= current;\n            } else {\n                result += current;\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Extract preview text (first 200 chars)\n     */\n    private static extractPreview(content: string): string {\n        // Remove markdown formatting for preview\n        const plainText = content\n            .replace(/#+\\s/g, '') // Remove headers\n            .replace(/\\*\\*/g, '') // Remove bold\n            .replace(/\\*/g, '') // Remove italic\n            .replace(/\\n+/g, ' ') // Replace newlines with space\n            .trim();\n\n        return plainText.substring(0, 200) + (plainText.length > 200 ? '...' : '');\n    }\n\n    /**\n     * Merge two adjacent chapters\n     */\n    static mergeChapters(\n        chapter1: DetectedChapter,\n        chapter2: DetectedChapter\n    ): DetectedChapter {\n        return {\n            id: chapter1.id,\n            title: `${chapter1.title} & ${chapter2.title}`,\n            startPage: chapter1.startPage,\n            endPage: chapter2.endPage,\n            content: `${chapter1.content}\\n\\n${chapter2.content}`,\n            previewText: this.extractPreview(`${chapter1.content}\\n\\n${chapter2.content}`),\n            chapterNumber: chapter1.chapterNumber\n        };\n    }\n\n    /**\n     * Split a chapter at a specific page\n     */\n    static splitChapter(\n        chapter: DetectedChapter,\n        splitAtPage: number,\n        pages: LlamaParsePageResult[]\n    ): [DetectedChapter, DetectedChapter] {\n        const part1Pages = pages.filter(p => p.page >= chapter.startPage && p.page < splitAtPage);\n        const part2Pages = pages.filter(p => p.page >= splitAtPage && p.page <= chapter.endPage);\n\n        const part1Content = part1Pages.map(p => p.md || p.text).join('\\n\\n');\n        const part2Content = part2Pages.map(p => p.md || p.text).join('\\n\\n');\n\n        return [\n            {\n                id: `${chapter.id}-part1`,\n                title: `${chapter.title} (Part 1)`,\n                startPage: chapter.startPage,\n                endPage: splitAtPage - 1,\n                content: part1Content,\n                previewText: this.extractPreview(part1Content),\n                chapterNumber: chapter.chapterNumber\n            },\n            {\n                id: `${chapter.id}-part2`,\n                title: `${chapter.title} (Part 2)`,\n                startPage: splitAtPage,\n                endPage: chapter.endPage,\n                content: part2Content,\n                previewText: this.extractPreview(part2Content),\n                chapterNumber: chapter.chapterNumber ? chapter.chapterNumber + 1 : null\n            }\n        ];\n    }\n}\n","import { useState, useEffect } from \"react\";\n\nexport type QuestionType = \"MCQ\" | \"TRUE_FALSE\" | \"FILL_IN_BLANK\" | \"SHORT_ANSWER\" | \"LONG_ANSWER\";\n\nexport interface QuestionBankConfigState {\n    easy: Record<QuestionType, number>;\n    medium: Record<QuestionType, number>;\n    hard: Record<QuestionType, number>;\n}\n\nconst DEFAULT_CONFIG: QuestionBankConfigState = {\n    easy: { MCQ: 20, TRUE_FALSE: 20, FILL_IN_BLANK: 20, SHORT_ANSWER: 10, LONG_ANSWER: 10 },\n    medium: { MCQ: 20, TRUE_FALSE: 20, FILL_IN_BLANK: 20, SHORT_ANSWER: 10, LONG_ANSWER: 10 },\n    hard: { MCQ: 15, TRUE_FALSE: 15, FILL_IN_BLANK: 10, SHORT_ANSWER: 10, LONG_ANSWER: 10 },\n};\n\nexport function QuestionBankConfig({\n    onChange\n}: {\n    onChange: (config: QuestionBankConfigState) => void;\n}) {\n    const [config, setConfig] = useState<QuestionBankConfigState>(DEFAULT_CONFIG);\n    const [isOpen, setIsOpen] = useState(false);\n\n    useEffect(() => {\n        onChange(config);\n    }, [config, onChange]);\n\n    const updateCount = (difficulty: keyof QuestionBankConfigState, type: QuestionType, value: number) => {\n        setConfig(prev => ({\n            ...prev,\n            [difficulty]: {\n                ...prev[difficulty],\n                [type]: value\n            }\n        }));\n    };\n\n    const totalQuestions = Object.values(config).reduce((acc: number, diff: Record<QuestionType, number>) =>\n        acc + Object.values(diff).reduce((sum: number, count: number) => sum + count, 0), 0\n    );\n\n    return (\n        <div className=\"border rounded-lg p-4 bg-gray-50\">\n            <button\n                type=\"button\"\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"flex items-center justify-between w-full text-left\"\n            >\n                <div>\n                    <h3 className=\"text-sm font-medium text-gray-900\">Question Bank Configuration</h3>\n                    <p className=\"text-xs text-gray-500\">\n                        Auto-generate {totalQuestions} questions per chapter\n                    </p>\n                </div>\n                <span className=\"text-indigo-600 text-sm font-medium\">\n                    {isOpen ? \"Hide\" : \"Customize\"}\n                </span>\n            </button>\n\n            {isOpen && (\n                <div className=\"mt-4 space-y-6\">\n                    {(['easy', 'medium', 'hard'] as const).map((difficulty) => (\n                        <div key={difficulty}>\n                            <h4 className=\"text-xs font-semibold text-gray-500 uppercase mb-2\">{difficulty} Difficulty</h4>\n                            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3\">\n                                {(['MCQ', 'TRUE_FALSE', 'FILL_IN_BLANK', 'SHORT_ANSWER', 'LONG_ANSWER'] as const).map((type) => (\n                                    <div key={type}>\n                                        <label className=\"block text-[10px] text-gray-500 mb-1\">\n                                            {type.replace(/_/g, \" \")}\n                                        </label>\n                                        <input\n                                            type=\"number\"\n                                            min=\"0\"\n                                            max=\"100\"\n                                            value={config[difficulty][type] || 0}\n                                            onChange={(e) => updateCount(difficulty, type, parseInt(e.target.value) || 0)}\n                                            className=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-xs border p-1\"\n                                        />\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    ))}\n\n                    <div className=\"text-xs text-gray-500 italic border-t pt-2\">\n                        * Questions will be generated in the background after chapter processing is complete.\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}