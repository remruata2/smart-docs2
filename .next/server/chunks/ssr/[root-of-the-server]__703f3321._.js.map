{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../src/lib/db.ts","../../../../src/lib/prisma.ts","../../../../node_modules/%40vercel/oidc/dist/token-error.js","../../../../src/lib/comparison-service.ts","../../../../src/app/actions/compare.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","import { PrismaClient } from '../generated/prisma';\n\n// Define the global type for PrismaClient\ndeclare global {\n  var prisma: PrismaClient | undefined;\n}\n\n// PrismaClient is attached to the `global` object in development to prevent\n// exhausting your database connection limit.\nexport const db = global.prisma || new PrismaClient();\n\n// In development, keep the connection alive between hot reloads\nif (process.env.NODE_ENV !== 'production') global.prisma = db;\n","import { db } from \"./db\";\n\nexport const prisma = db;\nexport default prisma;\n","\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_error_exports = {};\n__export(token_error_exports, {\n  VercelOidcTokenError: () => VercelOidcTokenError\n});\nmodule.exports = __toCommonJS(token_error_exports);\nclass VercelOidcTokenError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"VercelOidcTokenError\";\n    this.cause = cause;\n  }\n  toString() {\n    if (this.cause) {\n      return `${this.name}: ${this.message}: ${this.cause}`;\n    }\n    return `${this.name}: ${this.message}`;\n  }\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  VercelOidcTokenError\n});\n","import { prisma } from \"@/lib/prisma\";\nimport { getProviderApiKey } from \"@/lib/ai-key-store\";\nimport { generateObject } from \"ai\";\nimport { z } from \"zod\";\nimport { createGoogleGenerativeAI } from \"@ai-sdk/google\";\n\n// Define the structure of a \"Difference\"\nexport const ComparisonSchema = z.object({\n    summary: z.string().describe(\"Executive summary of major changes\"),\n    differences: z.array(z.object({\n        category: z.enum([\"Critical\", \"Major\", \"Minor\", \"Formatting\"]),\n        clause: z.string().describe(\"Name of the clause or section affected\"),\n        docA_content: z.string().describe(\"What Document A says (quote)\"),\n        docB_content: z.string().describe(\"What Document B says (quote)\"),\n        implication: z.string().describe(\"Why this change matters (risk analysis)\"),\n        page_A: z.number().optional().describe(\"Page number in Doc A\"),\n        page_B: z.number().optional().describe(\"Page number in Doc B\"),\n    }))\n});\n\nexport type ComparisonResult = z.infer<typeof ComparisonSchema>;\n\nexport async function compareDocuments(fileIdA: number, fileIdB: number) {\n    // 1. Fetch Documents\n    const [docA, docB] = await Promise.all([\n        prisma.fileList.findUnique({ where: { id: fileIdA } }),\n        prisma.fileList.findUnique({ where: { id: fileIdB } })\n    ]);\n\n    if (!docA || !docB) {\n        throw new Error(\"One or both documents not found.\");\n    }\n\n    if (!docA.note || !docB.note) {\n        throw new Error(\"One or both documents haven't been parsed yet (missing content in 'note' field).\");\n    }\n\n    // 2. Prepare Prompt\n    const prompt = `\n    Compare these two documents. Identify substantive differences, risks, and changes in obligations.\n    Ignore minor formatting changes (spacing, fonts) unless they change meaning.\n\n    DOCUMENT A (${docA.title}):\n    ${docA.note}\n\n    DOCUMENT B (${docB.title}):\n    ${docB.note}\n  `;\n\n    // 3. Call AI (Gemini 1.5 Pro)\n    // We use getProviderApiKey to get the raw key, then create the provider instance\n    const { apiKey } = await getProviderApiKey({ provider: \"gemini\" });\n\n    if (!apiKey) {\n        throw new Error(\"Gemini API key not found. Please configure it in settings.\");\n    }\n\n    const google = createGoogleGenerativeAI({ apiKey });\n\n    const { object } = await generateObject({\n        model: google(\"gemini-1.5-pro\"), // Pro is required for heavy reasoning\n        schema: ComparisonSchema,\n        prompt: prompt,\n    });\n\n    return {\n        ...object,\n        docA: { id: docA.id, title: docA.title },\n        docB: { id: docB.id, title: docB.title }\n    };\n}\n","\"use server\";\n\nimport { compareDocuments } from \"@/lib/comparison-service\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function compareFilesAction(fileIdA: number, fileIdB: number) {\n    try {\n        const result = await compareDocuments(fileIdA, fileIdB);\n        return { success: true, data: result };\n    } catch (error: any) {\n        console.error(\"Comparison failed:\", error);\n        return { success: false, error: error.message };\n    }\n}\n\nexport async function getPageLayout(fileId: number, pageNumber: number) {\n    try {\n        const chunks = await prisma.fileChunk.findMany({\n            where: {\n                file_id: fileId,\n                page_number: pageNumber\n            },\n            select: {\n                content: true,\n                bbox: true\n            }\n        });\n\n        const layoutItems = chunks.map(chunk => ({\n            text: chunk.content,\n            bbox: chunk.bbox as number[] // Assuming bbox is stored as JSON array\n        }));\n\n        return { success: true, data: layoutItems };\n    } catch (error: any) {\n        console.error(\"Failed to fetch layout:\", error);\n        return { success: false, error: error.message };\n    }\n}\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1,4]}