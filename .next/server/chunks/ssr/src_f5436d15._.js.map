{"version":3,"sources":["../../../../src/components/admin/FilterSelect.tsx","../../../../src/app/admin/chapters/chapter-list-client.tsx"],"sourcesContent":["'use client';\n\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { useCallback } from \"react\";\n\ninterface FilterSelectProps {\n    name: string;\n    options: { value: string; label: string }[];\n    placeholder: string;\n    className?: string;\n}\n\nexport default function FilterSelect({ name, options, placeholder, className = \"\" }: FilterSelectProps) {\n    const router = useRouter();\n    const searchParams = useSearchParams();\n    const currentValue = searchParams.get(name) || \"\";\n\n    const handleChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\n        const value = e.target.value;\n        const params = new URLSearchParams(searchParams.toString());\n\n        if (value) {\n            params.set(name, value);\n        } else {\n            params.delete(name);\n        }\n\n        router.push(`?${params.toString()}`);\n    }, [name, router, searchParams]);\n\n    return (\n        <select\n            name={name}\n            value={currentValue}\n            onChange={handleChange}\n            className={`block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2 ${className}`}\n        >\n            <option value=\"\">{placeholder}</option>\n            {options.map(opt => (\n                <option key={opt.value} value={opt.value}>{opt.label}</option>\n            ))}\n        </select>\n    );\n}\n","'use client';\n\nimport { useState, useTransition, useEffect } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { toast } from \"sonner\";\n\ninterface ChapterListClientProps {\n    chapters: any[];\n    onDelete: (ids: string[]) => Promise<void>;\n}\n\nexport default function ChapterListClient({ chapters, onDelete }: ChapterListClientProps) {\n    const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n    const [isPending, startTransition] = useTransition();\n    const router = useRouter();\n\n    // Check if any chapters are still processing\n    const hasProcessingChapters = chapters.some(\n        ch => ch.processing_status === 'PENDING' || ch.processing_status === 'PROCESSING'\n    );\n\n    // Auto-refresh when chapters are processing\n    useEffect(() => {\n        if (!hasProcessingChapters) return;\n\n        const interval = setInterval(() => {\n            router.refresh();\n        }, 5000); // Poll every 5 seconds\n\n        return () => clearInterval(interval);\n    }, [hasProcessingChapters, router]);\n\n    const toggleSelect = (id: string) => {\n        const newSelected = new Set(selectedIds);\n        if (newSelected.has(id)) {\n            newSelected.delete(id);\n        } else {\n            newSelected.add(id);\n        }\n        setSelectedIds(newSelected);\n    };\n\n    const toggleSelectAll = () => {\n        if (selectedIds.size === chapters.length) {\n            setSelectedIds(new Set());\n        } else {\n            setSelectedIds(new Set(chapters.map(c => c.id.toString())));\n        }\n    };\n\n    const handleDeleteSelected = async () => {\n        if (selectedIds.size === 0) {\n            toast.error(\"No chapters selected\");\n            return;\n        }\n\n        if (!confirm(`Delete ${selectedIds.size} selected chapter(s)?`)) {\n            return;\n        }\n\n        startTransition(async () => {\n            try {\n                await onDelete(Array.from(selectedIds));\n                toast.success(`Deleted ${selectedIds.size} chapter(s)`);\n                setSelectedIds(new Set());\n                router.refresh();\n            } catch (error: any) {\n                toast.error(error.message || \"Failed to delete chapters\");\n            }\n        });\n    };\n\n    function getStatusBadge(status: string) {\n        switch (status) {\n            case 'PENDING':\n                return <span className=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800\">ðŸŸ¡ Pending</span>;\n            case 'PROCESSING':\n                return <span className=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 animate-pulse\">ðŸ”µ Processing</span>;\n            case 'COMPLETED':\n                return <span className=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800\">ðŸŸ¢ Ready</span>;\n            case 'FAILED':\n                return <span className=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800\">ðŸ”´ Failed</span>;\n            default:\n                return null;\n        }\n    }\n\n    return (\n        <div>\n            {/* Processing Notice */}\n            {hasProcessingChapters && (\n                <div className=\"mb-4 bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center gap-3\">\n                    <div className=\"animate-spin h-5 w-5 border-2 border-blue-600 border-t-transparent rounded-full\"></div>\n                    <span className=\"text-sm text-blue-900\">\n                        {chapters.filter(ch => ch.processing_status === 'PROCESSING').length} chapter(s) processing... Auto-refreshing every 5 seconds\n                    </span>\n                </div>\n            )}\n\n            {/* Bulk Actions Bar */}\n            {selectedIds.size > 0 && (\n                <div className=\"mb-4 bg-indigo-50 border border-indigo-200 rounded-lg p-4 flex items-center justify-between\">\n                    <span className=\"text-sm font-medium text-indigo-900\">\n                        {selectedIds.size} chapter(s) selected\n                    </span>\n                    <button\n                        onClick={handleDeleteSelected}\n                        disabled={isPending}\n                        className=\"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50 text-sm font-medium\"\n                    >\n                        {isPending ? \"Deleting...\" : \"Delete Selected\"}\n                    </button>\n                </div>\n            )}\n\n            {/* Chapters List */}\n            <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n                <ul className=\"divide-y divide-gray-200\">\n                    {/* Select All Row */}\n                    <li className=\"bg-gray-50 border-b-2 border-gray-300\">\n                        <div className=\"px-4 py-3 flex items-center\">\n                            <input\n                                type=\"checkbox\"\n                                checked={selectedIds.size === chapters.length && chapters.length > 0}\n                                onChange={toggleSelectAll}\n                                className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n                            />\n                            <label className=\"ml-3 text-sm font-medium text-gray-700\">\n                                Select All ({chapters.length})\n                            </label>\n                        </div>\n                    </li>\n\n                    {chapters.map((chapter) => (\n                        <li key={chapter.id} className=\"hover:bg-gray-50 transition\">\n                            <div className=\"px-4 py-4 sm:px-6 flex items-start gap-4\">\n                                {/* Checkbox */}\n                                <input\n                                    type=\"checkbox\"\n                                    checked={selectedIds.has(chapter.id.toString())}\n                                    onChange={() => toggleSelect(chapter.id.toString())}\n                                    onClick={(e) => e.stopPropagation()}\n                                    className=\"mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n                                />\n\n                                {/* Chapter Content - Clickable */}\n                                <div\n                                    className=\"flex-1 cursor-pointer\"\n                                    onClick={() => router.push(`/admin/chapters/${chapter.id}`)}\n                                >\n                                    <div className=\"flex items-center justify-between\">\n                                        <div className=\"flex items-center gap-2 flex-wrap\">\n                                            <span className=\"text-sm font-medium text-indigo-600\">\n                                                {chapter.title}\n                                            </span>\n                                            {getStatusBadge(chapter.processing_status)}\n                                            {chapter.is_global && (\n                                                <span className=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800\">\n                                                    Global\n                                                </span>\n                                            )}\n                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${chapter.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n                                                {chapter.is_active ? 'Active' : 'Inactive'}\n                                            </span>\n                                        </div>\n                                    </div>\n                                    <div className=\"mt-2 sm:flex sm:justify-between\">\n                                        <div className=\"sm:flex\">\n                                            <p className=\"flex items-center text-sm text-gray-500 mr-6\">\n                                                Subject: {chapter.subject.name}\n                                            </p>\n                                            <p className=\"flex items-center text-sm text-gray-500 mr-6\">\n                                                Program: {chapter.subject.program.name}\n                                            </p>\n                                            <p className=\"flex items-center text-sm text-gray-500 mr-6\">\n                                                Board: {chapter.subject.program.board.name}\n                                            </p>\n                                        </div>\n                                        <div className=\"mt-2 flex items-center text-sm text-gray-500 sm:mt-0\">\n                                            <p className=\"mr-4\">Chunks: {chapter._count.chunks}</p>\n                                            <p>Pages: {chapter._count.pages}</p>\n                                        </div>\n                                    </div>\n                                    {chapter.processing_status === 'FAILED' && chapter.error_message && (\n                                        <div className=\"mt-2 text-xs text-red-600 bg-red-50 p-2 rounded\">\n                                            Error: {chapter.error_message}\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        </li>\n                    ))}\n                    {chapters.length === 0 && (\n                        <li className=\"px-4 py-4 text-center text-gray-500\">No chapters found.</li>\n                    )}\n                </ul>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}